<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lumina AI â€” The Smartest Way to Learn</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&family=Space+Mono&family=Lexend:wght@300;400;600&family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold: #C9A84C;
  --gold-light: #E8C97A;
  --gold-dark: #9A7A2E;
  --black: #07080C;
  --bg1: #0A0C12;
  --bg2: #0F1118;
  --bg3: #151821;
  --bg4: #1C2030;
  --white: #F5F2EC;
  --muted: #8892A4;
  --border: rgba(201,168,76,0.15);
  --green: #4ADE80;
  --red: #FB7185;
  --blue: #60A5FA;
  --purple: #A78BFA;
  --orange: #FB923C;
  --pink: #F472B6;
  --radius: 12px;
  --shadow: 0 8px 32px rgba(0,0,0,0.4);
  --glow: 0 0 40px rgba(201,168,76,0.15);
  --font-body: 'DM Sans', sans-serif;
  --font-head: 'Playfair Display', serif;
  --font-mono: 'Space Mono', monospace;
}

/* ACCESSIBILITY MODES */
body.mode-dyslexia { font-family: 'Lexend', sans-serif !important; letter-spacing: 0.05em; line-height: 2; }
body.mode-dyslexia * { font-family: inherit !important; }
body.mode-adhd .content-block { border-left: 3px solid var(--gold); margin-bottom: 1.5rem; }
body.mode-adhd .step-badge { display: inline-flex !important; }
body.mode-dyscalculia .math-visual { display: block !important; }

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-body);
  background: var(--black);
  color: var(--white);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg1); }
::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
  background: rgba(7,8,12,0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 2rem;
  height: 64px;
  display: flex; align-items: center; justify-content: space-between;
  transition: all .3s;
}
.nav-logo {
  font-family: var(--font-head);
  font-size: 1.5rem;
  font-weight: 900;
  color: var(--white);
  cursor: pointer;
}
.nav-logo span { color: var(--gold); }
.nav-links { display: flex; gap: .25rem; align-items: center; }
.nav-links a {
  color: var(--muted); font-size: .875rem; font-weight: 500;
  padding: .5rem .75rem; border-radius: 8px;
  cursor: pointer; text-decoration: none;
  transition: all .2s;
}
.nav-links a:hover, .nav-links a.active { color: var(--white); background: var(--bg4); }
.nav-right { display: flex; gap: .75rem; align-items: center; }

/* Accessibility toggles */
.a11y-bar {
  display: flex; gap: .5rem; align-items: center;
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 20px; padding: .25rem .5rem;
}
.a11y-btn {
  padding: .35rem .65rem; border-radius: 12px; border: none;
  background: transparent; color: var(--muted);
  font-size: .75rem; font-weight: 600; cursor: pointer;
  transition: all .2s; white-space: nowrap;
}
.a11y-btn.on { background: var(--gold); color: var(--black); }

.btn {
  padding: .6rem 1.25rem; border-radius: 8px; font-size: .875rem;
  font-weight: 600; cursor: pointer; transition: all .2s; border: none;
}
.btn-outline { background: transparent; border: 1px solid var(--border); color: var(--white); }
.btn-outline:hover { border-color: var(--gold); color: var(--gold); }
.btn-gold { background: var(--gold); color: var(--black); }
.btn-gold:hover { background: var(--gold-light); transform: translateY(-1px); box-shadow: 0 4px 20px rgba(201,168,76,0.3); }

/* XP Badge */
#xp-badge {
  display: none;
  align-items: center; gap: .4rem;
  background: var(--bg3); border: 1px solid var(--gold);
  border-radius: 20px; padding: .35rem .75rem;
  font-size: .8rem; font-weight: 700; color: var(--gold);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGES / ROUTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page { display: none; min-height: 100vh; padding-top: 64px; }
.page.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-home {
  background: var(--black);
  overflow: hidden;
}

/* Animated background */
.hero-bg {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none; z-index: 0;
  overflow: hidden;
}
.orb {
  position: absolute; border-radius: 50%;
  filter: blur(80px); opacity: 0.12;
  animation: float 8s ease-in-out infinite;
}
.orb-1 { width: 600px; height: 600px; background: var(--gold); top: -200px; right: -100px; animation-delay: 0s; }
.orb-2 { width: 400px; height: 400px; background: var(--purple); bottom: 10%; left: -100px; animation-delay: 3s; }
.orb-3 { width: 300px; height: 300px; background: var(--blue); top: 40%; left: 40%; animation-delay: 5s; }

@keyframes float {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-30px) scale(1.05); }
}

.hero {
  position: relative; z-index: 1;
  min-height: calc(100vh - 64px);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  text-align: center; padding: 4rem 2rem 2rem;
}
.hero-badge {
  display: inline-flex; align-items: center; gap: .5rem;
  background: rgba(201,168,76,0.1); border: 1px solid var(--gold);
  border-radius: 20px; padding: .4rem 1rem;
  font-size: .8rem; font-weight: 600; color: var(--gold);
  margin-bottom: 2rem;
  animation: fadeUp .6s ease both;
}
.hero h1 {
  font-family: var(--font-head);
  font-size: clamp(2.5rem, 6vw, 5rem);
  font-weight: 900; line-height: 1.1;
  margin-bottom: 1.5rem;
  animation: fadeUp .6s ease .1s both;
}
.hero h1 em { font-style: normal; color: var(--gold); }
.hero p {
  font-size: clamp(1rem, 2vw, 1.2rem);
  color: var(--muted); max-width: 600px;
  line-height: 1.7; margin-bottom: 2.5rem;
  animation: fadeUp .6s ease .2s both;
}
.hero-actions {
  display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;
  animation: fadeUp .6s ease .3s both;
}
.btn-hero-primary {
  padding: 1rem 2.5rem; border-radius: 10px;
  background: var(--gold); color: var(--black);
  font-size: 1rem; font-weight: 700; border: none;
  cursor: pointer; transition: all .3s;
  box-shadow: 0 0 30px rgba(201,168,76,0.3);
}
.btn-hero-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 40px rgba(201,168,76,0.5); }
.btn-hero-secondary {
  padding: 1rem 2.5rem; border-radius: 10px;
  background: transparent; color: var(--white);
  font-size: 1rem; font-weight: 600;
  border: 1px solid rgba(255,255,255,0.2);
  cursor: pointer; transition: all .3s;
}
.btn-hero-secondary:hover { border-color: var(--gold); color: var(--gold); }

/* Trust bar */
.trust-bar {
  display: flex; gap: 2rem; flex-wrap: wrap; justify-content: center;
  margin-top: 3rem; padding-top: 2rem;
  border-top: 1px solid var(--border);
  animation: fadeUp .6s ease .4s both;
}
.trust-item { display: flex; align-items: center; gap: .5rem; color: var(--muted); font-size: .85rem; }
.trust-item i { color: var(--gold); }

/* VIDEO SECTION */
.video-section {
  position: relative; z-index: 1;
  padding: 5rem 2rem;
  text-align: center;
}
.section-label {
  display: inline-block;
  background: rgba(201,168,76,0.1);
  border: 1px solid var(--border);
  border-radius: 20px; padding: .3rem .9rem;
  font-size: .75rem; font-weight: 700;
  color: var(--gold); letter-spacing: .1em;
  text-transform: uppercase; margin-bottom: 1rem;
}
.video-section h2 {
  font-family: var(--font-head); font-size: clamp(1.8rem, 4vw, 3rem);
  margin-bottom: 1rem;
}
.video-section p { color: var(--muted); max-width: 500px; margin: 0 auto 3rem; line-height: 1.7; }

/* Interactive video player */
.video-player {
  max-width: 900px; margin: 0 auto;
  border-radius: 20px; overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: var(--shadow), var(--glow);
  background: var(--bg2);
  position: relative;
}
.video-main {
  background: var(--bg3);
  aspect-ratio: 16/9;
  position: relative;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  overflow: hidden;
}
.video-preview-content {
  text-align: center; padding: 2rem;
  position: relative; z-index: 2;
}
.video-play-btn {
  width: 80px; height: 80px;
  background: var(--gold); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; color: var(--black);
  margin: 0 auto 1.5rem;
  transition: all .3s;
  box-shadow: 0 0 40px rgba(201,168,76,0.4);
}
.video-main:hover .video-play-btn { transform: scale(1.1); box-shadow: 0 0 60px rgba(201,168,76,0.6); }
.video-preview-content h3 { font-family: var(--font-head); font-size: 1.8rem; margin-bottom: .5rem; }
.video-preview-content p { color: var(--muted); font-size: .9rem; }

/* Video chapters */
.video-chapters {
  display: flex; gap: 0;
  border-top: 1px solid var(--border);
  background: var(--bg2);
  overflow-x: auto;
}
.chapter-btn {
  flex: 1; min-width: 120px;
  padding: 1rem .75rem;
  background: transparent;
  border: none; border-right: 1px solid var(--border);
  color: var(--muted); font-size: .8rem;
  cursor: pointer; transition: all .2s;
  text-align: center;
}
.chapter-btn:hover, .chapter-btn.active { background: var(--bg3); color: var(--gold); }
.chapter-btn .chapter-icon { font-size: 1.2rem; margin-bottom: .25rem; display: block; }
.chapter-btn .chapter-time { font-size: .7rem; opacity: .6; }

/* Interactive question overlay */
.video-question {
  display: none;
  position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
  background: rgba(7,8,12,0.95); border: 2px solid var(--gold);
  border-radius: 16px; padding: 1.5rem 2rem;
  max-width: 600px; width: 90%;
  z-index: 10; text-align: center;
  animation: slideUp .3s ease;
}
.video-question.show { display: block; }
.video-question h4 { font-size: 1rem; margin-bottom: 1rem; color: var(--white); }
.vq-options { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; margin-top: 1rem; }
.vq-opt {
  padding: .75rem 1rem; border-radius: 8px;
  background: var(--bg3); border: 1px solid var(--border);
  color: var(--white); cursor: pointer;
  font-size: .875rem; transition: all .2s;
  text-align: left;
}
.vq-opt:hover { border-color: var(--gold); }
.vq-opt.correct { background: rgba(74,222,128,0.2); border-color: var(--green); color: var(--green); }
.vq-opt.wrong { background: rgba(251,113,133,0.2); border-color: var(--red); color: var(--red); }

/* FEATURES */
.features-section {
  position: relative; z-index: 1;
  padding: 5rem 2rem;
}
.features-section h2 {
  font-family: var(--font-head); font-size: clamp(1.8rem, 4vw, 3rem);
  text-align: center; margin-bottom: .75rem;
}
.features-section .sub { text-align: center; color: var(--muted); margin-bottom: 4rem; }

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem; max-width: 1200px; margin: 0 auto;
}
.feature-card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 2rem;
  transition: all .3s; cursor: pointer;
  position: relative; overflow: hidden;
}
.feature-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--gold), transparent);
  opacity: 0; transition: opacity .3s;
}
.feature-card:hover { transform: translateY(-4px); border-color: rgba(201,168,76,0.3); box-shadow: var(--shadow); }
.feature-card:hover::before { opacity: 1; }
.feature-icon {
  width: 56px; height: 56px;
  border-radius: 14px; background: var(--bg4);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.5rem; margin-bottom: 1.25rem;
  border: 1px solid var(--border);
}
.feature-card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: .5rem; }
.feature-card p { color: var(--muted); font-size: .875rem; line-height: 1.6; }
.feature-tag {
  display: inline-block; margin-top: 1rem;
  padding: .2rem .6rem; border-radius: 6px;
  font-size: .7rem; font-weight: 700;
  background: rgba(201,168,76,0.1); color: var(--gold);
  text-transform: uppercase; letter-spacing: .05em;
}

/* STATS */
.stats-section {
  position: relative; z-index: 1;
  padding: 4rem 2rem;
  background: var(--bg2);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.stats-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem; max-width: 1000px; margin: 0 auto; text-align: center;
}
.stat-num {
  font-family: var(--font-head); font-size: 3rem; font-weight: 900;
  color: var(--gold); line-height: 1;
}
.stat-label { color: var(--muted); font-size: .875rem; margin-top: .5rem; }

/* SUBJECTS */
.subjects-section {
  position: relative; z-index: 1;
  padding: 5rem 2rem;
}
.subjects-section h2 {
  font-family: var(--font-head); font-size: clamp(1.8rem, 4vw, 3rem);
  text-align: center; margin-bottom: 3rem;
}
.subjects-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 1rem; max-width: 1000px; margin: 0 auto 3rem;
}
.subject-pill {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 12px; padding: 1.25rem 1rem;
  text-align: center; cursor: pointer; transition: all .2s;
}
.subject-pill:hover { border-color: var(--gold); transform: translateY(-2px); }
.subject-pill .s-icon { font-size: 1.8rem; margin-bottom: .5rem; }
.subject-pill .s-name { font-size: .85rem; font-weight: 600; }
.subject-pill .s-level { font-size: .7rem; color: var(--gold); }

/* PRICING */
.pricing-section {
  position: relative; z-index: 1;
  padding: 5rem 2rem;
  background: var(--bg2);
}
.pricing-section h2 {
  font-family: var(--font-head); font-size: clamp(1.8rem, 4vw, 3rem);
  text-align: center; margin-bottom: 1rem;
}
.pricing-sub { text-align: center; color: var(--muted); margin-bottom: 3rem; }
.pricing-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem; max-width: 800px; margin: 0 auto;
}
.price-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 20px; padding: 2.5rem;
  position: relative; overflow: hidden;
}
.price-card.featured {
  border-color: var(--gold);
  box-shadow: var(--glow);
}
.price-card.featured::before {
  content: 'MOST POPULAR';
  position: absolute; top: 1.25rem; right: -2rem;
  background: var(--gold); color: var(--black);
  font-size: .65rem; font-weight: 800; letter-spacing: .1em;
  padding: .3rem 3rem;
  transform: rotate(35deg);
}
.price-name { font-size: .85rem; font-weight: 700; color: var(--gold); text-transform: uppercase; letter-spacing: .1em; }
.price-amount {
  font-family: var(--font-head); font-size: 3rem; font-weight: 900;
  margin: .75rem 0 .25rem;
}
.price-amount span { font-size: 1rem; font-weight: 400; color: var(--muted); }
.price-desc { color: var(--muted); font-size: .875rem; margin-bottom: 1.5rem; }
.price-features { list-style: none; margin-bottom: 2rem; }
.price-features li {
  display: flex; align-items: center; gap: .75rem;
  padding: .6rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
  font-size: .875rem; color: var(--muted);
}
.price-features li i { color: var(--gold); width: 16px; text-align: center; flex-shrink: 0; }

/* CTA */
.cta-section {
  position: relative; z-index: 1;
  padding: 6rem 2rem; text-align: center;
  background: radial-gradient(ellipse at center, rgba(201,168,76,0.08) 0%, transparent 70%);
}
.cta-section h2 {
  font-family: var(--font-head); font-size: clamp(2rem, 5vw, 4rem);
  margin-bottom: 1rem;
}
.cta-section p { color: var(--muted); max-width: 500px; margin: 0 auto 2rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-auth {
  display: none; align-items: center; justify-content: center;
  min-height: 100vh; padding: 2rem;
  background: radial-gradient(ellipse at 50% 0%, rgba(201,168,76,0.08) 0%, transparent 60%);
}
#page-auth.active { display: flex; }
.auth-box {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 24px; padding: 3rem;
  width: 100%; max-width: 480px;
  box-shadow: var(--shadow);
}
.auth-logo {
  font-family: var(--font-head); font-size: 2rem; font-weight: 900;
  text-align: center; margin-bottom: .5rem;
}
.auth-logo span { color: var(--gold); }
.auth-sub { text-align: center; color: var(--muted); font-size: .875rem; margin-bottom: 2.5rem; }
.auth-tabs {
  display: flex; background: var(--bg3); border-radius: 10px;
  padding: .25rem; margin-bottom: 2rem;
}
.auth-tab {
  flex: 1; padding: .6rem; border-radius: 8px;
  border: none; background: transparent;
  color: var(--muted); font-size: .875rem; font-weight: 600;
  cursor: pointer; transition: all .2s;
}
.auth-tab.active { background: var(--gold); color: var(--black); }
.form-group { margin-bottom: 1.25rem; }
.form-group label { display: block; font-size: .8rem; font-weight: 600; color: var(--muted); margin-bottom: .5rem; text-transform: uppercase; letter-spacing: .05em; }
.form-group input, .form-group select {
  width: 100%; padding: .875rem 1rem;
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 10px; color: var(--white);
  font-size: .925rem; font-family: var(--font-body);
  transition: border .2s;
}
.form-group input:focus, .form-group select:focus {
  outline: none; border-color: var(--gold);
}
.form-group select option { background: var(--bg3); }
.auth-step { display: none; }
.auth-step.active { display: block; }
.step-indicator {
  display: flex; gap: .5rem; justify-content: center; margin-bottom: 2rem;
}
.step-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--bg4); transition: all .3s;
}
.step-dot.active { background: var(--gold); width: 24px; border-radius: 4px; }
.difficulty-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
.diff-card {
  padding: 1rem; border-radius: 10px;
  background: var(--bg3); border: 2px solid var(--border);
  cursor: pointer; transition: all .2s; text-align: center;
}
.diff-card:hover { border-color: rgba(201,168,76,0.4); }
.diff-card.selected { border-color: var(--gold); background: rgba(201,168,76,0.08); }
.diff-card .diff-icon { font-size: 1.5rem; margin-bottom: .4rem; }
.diff-card .diff-name { font-size: .8rem; font-weight: 700; }
.diff-card .diff-desc { font-size: .7rem; color: var(--muted); margin-top: .2rem; }
.plan-options { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; margin-bottom: 1.5rem; }
.plan-opt {
  padding: 1.25rem 1rem; border-radius: 12px;
  background: var(--bg3); border: 2px solid var(--border);
  cursor: pointer; transition: all .2s; text-align: center;
}
.plan-opt.selected { border-color: var(--gold); }
.plan-opt .plan-name { font-weight: 700; margin-bottom: .25rem; }
.plan-opt .plan-price { font-size: 1.2rem; color: var(--gold); font-weight: 800; }
.plan-opt .plan-tag { font-size: .7rem; color: var(--muted); }
.gdpr-check { display: flex; gap: .75rem; align-items: flex-start; margin-bottom: 1.5rem; }
.gdpr-check input { width: auto; margin-top: .2rem; accent-color: var(--gold); }
.gdpr-check label { font-size: .8rem; color: var(--muted); line-height: 1.5; cursor: pointer; }
.gdpr-check a { color: var(--gold); text-decoration: none; }
.btn-full { width: 100%; padding: 1rem; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; border: none; background: var(--gold); color: var(--black); transition: all .2s; margin-top: .5rem; }
.btn-full:hover { background: var(--gold-light); }
.btn-back { background: transparent; border: 1px solid var(--border); color: var(--muted); width: 100%; padding: .75rem; border-radius: 10px; cursor: pointer; font-size: .875rem; margin-top: .75rem; transition: all .2s; }
.btn-back:hover { border-color: var(--muted); color: var(--white); }
.login-form { display: none; }
.login-form.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-dashboard {
  display: none;
  flex-direction: row;
}
#page-dashboard.active { display: flex; }

.sidebar {
  width: 260px; min-height: calc(100vh - 64px);
  background: var(--bg2); border-right: 1px solid var(--border);
  padding: 1.5rem 1rem; position: sticky; top: 64px;
  flex-shrink: 0; overflow-y: auto;
}
.sidebar-user {
  display: flex; align-items: center; gap: .75rem;
  padding: .75rem; background: var(--bg3);
  border-radius: 12px; margin-bottom: 1.5rem;
  border: 1px solid var(--border);
}
.avatar {
  width: 42px; height: 42px; border-radius: 50%;
  background: linear-gradient(135deg, var(--gold), var(--gold-dark));
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; font-weight: 700; color: var(--black);
  flex-shrink: 0;
}
.sidebar-user-info .user-name { font-weight: 700; font-size: .9rem; }
.sidebar-user-info .user-plan { font-size: .75rem; color: var(--gold); }
.sidebar-xp {
  margin-bottom: 1.5rem;
  padding: .75rem; background: var(--bg3);
  border-radius: 10px; border: 1px solid var(--border);
}
.xp-header { display: flex; justify-content: space-between; font-size: .75rem; margin-bottom: .4rem; }
.xp-level { font-weight: 700; color: var(--gold); }
.xp-bar { height: 6px; background: var(--bg4); border-radius: 3px; overflow: hidden; }
.xp-fill { height: 100%; background: linear-gradient(90deg, var(--gold), var(--gold-light)); border-radius: 3px; transition: width .5s ease; }
.sidebar-nav { display: flex; flex-direction: column; gap: .25rem; }
.sidebar-item {
  display: flex; align-items: center; gap: .75rem;
  padding: .75rem 1rem; border-radius: 10px;
  color: var(--muted); font-size: .875rem; font-weight: 500;
  cursor: pointer; transition: all .2s;
  text-decoration: none;
}
.sidebar-item:hover { background: var(--bg3); color: var(--white); }
.sidebar-item.active { background: rgba(201,168,76,0.1); color: var(--gold); border: 1px solid rgba(201,168,76,0.2); }
.sidebar-item i { width: 18px; text-align: center; }
.sidebar-badge {
  margin-left: auto; background: var(--gold);
  color: var(--black); border-radius: 10px;
  font-size: .65rem; font-weight: 800;
  padding: .15rem .45rem;
}
.sidebar-section-label {
  font-size: .65rem; font-weight: 700; color: var(--muted);
  text-transform: uppercase; letter-spacing: .1em;
  padding: 1rem 1rem .5rem;
}

.main-content {
  flex: 1; padding: 2rem;
  overflow-y: auto; min-height: calc(100vh - 64px);
}
.page-title {
  font-family: var(--font-head); font-size: 2rem; font-weight: 700;
  margin-bottom: .25rem;
}
.page-subtitle { color: var(--muted); font-size: .9rem; margin-bottom: 2rem; }

/* Subpages within dashboard */
.subpage { display: none; }
.subpage.active { display: block; }

/* Stat cards */
.stats-row {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 1rem; margin-bottom: 2rem;
}
.stat-card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 1.5rem;
  transition: all .2s;
}
.stat-card:hover { border-color: rgba(201,168,76,0.2); }
.stat-card-label { font-size: .75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .05em; margin-bottom: .5rem; }
.stat-card-value { font-family: var(--font-head); font-size: 2rem; font-weight: 700; }
.stat-card-change { font-size: .75rem; color: var(--green); margin-top: .25rem; }

/* Dashboard grid */
.dash-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
@media(max-width:900px){ .dash-grid { grid-template-columns: 1fr; } .sidebar { display: none; } }

.card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); overflow: hidden;
}
.card-header {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.card-title { font-weight: 700; font-size: .95rem; }
.card-body { padding: 1.5rem; }

/* Chat widget */
.chat-messages {
  height: 320px; overflow-y: auto;
  display: flex; flex-direction: column; gap: .75rem;
  padding: 1rem 1.5rem;
}
.msg {
  max-width: 80%;
  padding: .75rem 1rem;
  border-radius: 12px; font-size: .875rem; line-height: 1.6;
  animation: msgIn .3s ease;
}
.msg.bot { background: var(--bg3); border: 1px solid var(--border); align-self: flex-start; border-bottom-left-radius: 4px; }
.msg.user { background: var(--gold); color: var(--black); align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; }
.msg.typing span { display: inline-block; width: 6px; height: 6px; background: var(--muted); border-radius: 50%; animation: bounce .8s infinite; margin: 0 1px; }
.msg.typing span:nth-child(2) { animation-delay: .15s; }
.msg.typing span:nth-child(3) { animation-delay: .3s; }

.chat-input-row {
  display: flex; gap: .75rem; padding: 1rem 1.5rem;
  border-top: 1px solid var(--border);
}
.chat-input {
  flex: 1; padding: .75rem 1rem;
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 10px; color: var(--white);
  font-size: .875rem; font-family: var(--font-body);
  resize: none; height: 44px; line-height: 1.4;
}
.chat-input:focus { outline: none; border-color: var(--gold); }
.chat-send {
  padding: .75rem 1.25rem;
  background: var(--gold); color: var(--black);
  border: none; border-radius: 10px;
  font-weight: 700; font-size: .875rem;
  cursor: pointer; transition: all .2s;
}
.chat-send:hover { background: var(--gold-light); }

/* Progress bars */
.progress-item { margin-bottom: 1rem; }
.progress-header { display: flex; justify-content: space-between; font-size: .85rem; margin-bottom: .4rem; }
.progress-bar { height: 8px; background: var(--bg4); border-radius: 4px; overflow: hidden; }
.progress-fill { height: 100%; border-radius: 4px; transition: width .8s ease; }

/* Activity feed */
.activity-item {
  display: flex; align-items: center; gap: .75rem;
  padding: .75rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
}
.activity-icon {
  width: 36px; height: 36px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: .9rem; flex-shrink: 0;
}
.activity-text { font-size: .85rem; }
.activity-time { font-size: .75rem; color: var(--muted); margin-left: auto; flex-shrink: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI TUTOR PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tutor-layout {
  display: grid; grid-template-columns: 220px 1fr;
  gap: 0; height: calc(100vh - 64px);
}
.tutor-subjects {
  background: var(--bg3); border-right: 1px solid var(--border);
  padding: 1.5rem 1rem; overflow-y: auto;
}
.tutor-subjects h4 { font-size: .75rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .1em; margin-bottom: 1rem; }
.subj-btn {
  display: flex; align-items: center; gap: .6rem;
  width: 100%; padding: .7rem .9rem;
  border-radius: 8px; border: 1px solid transparent;
  background: transparent; color: var(--muted);
  font-size: .85rem; cursor: pointer; transition: all .2s;
  text-align: left; margin-bottom: .25rem;
}
.subj-btn:hover { background: var(--bg4); color: var(--white); }
.subj-btn.active { background: rgba(201,168,76,0.1); color: var(--gold); border-color: rgba(201,168,76,0.2); }

.tutor-chat {
  display: flex; flex-direction: column;
  height: 100%;
}
.tutor-header {
  padding: 1.25rem 2rem;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  background: var(--bg2);
}
.tutor-header h3 { font-size: 1.1rem; font-weight: 700; }
.tutor-header p { font-size: .8rem; color: var(--muted); }
.quick-actions { display: flex; gap: .5rem; flex-wrap: wrap; padding: 1rem 2rem; border-bottom: 1px solid var(--border); background: var(--bg2); }
.quick-btn {
  padding: .4rem .9rem; border-radius: 20px;
  background: var(--bg3); border: 1px solid var(--border);
  color: var(--muted); font-size: .8rem;
  cursor: pointer; transition: all .2s;
}
.quick-btn:hover { border-color: var(--gold); color: var(--gold); }
.tutor-messages {
  flex: 1; overflow-y: auto;
  padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 1rem;
}
.tutor-input-area {
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--border);
  background: var(--bg2);
}
.tutor-input-row {
  display: flex; gap: .75rem; align-items: flex-end;
}
.tutor-input {
  flex: 1; padding: .875rem 1rem;
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 12px; color: var(--white);
  font-family: var(--font-body); font-size: .925rem;
  resize: none; min-height: 52px; max-height: 150px;
  transition: border .2s; line-height: 1.5;
}
.tutor-input:focus { outline: none; border-color: var(--gold); }
.tutor-send {
  padding: .875rem 1.5rem;
  background: var(--gold); color: var(--black);
  border: none; border-radius: 12px;
  font-weight: 700; cursor: pointer; transition: all .2s;
  font-size: .9rem;
}
.tutor-send:hover { background: var(--gold-light); transform: scale(1.02); }
.tts-btn {
  padding: .875rem; background: var(--bg3);
  border: 1px solid var(--border); border-radius: 12px;
  color: var(--muted); cursor: pointer; transition: all .2s;
}
.tts-btn:hover { border-color: var(--gold); color: var(--gold); }
.tts-btn.active { background: rgba(74,222,128,0.1); border-color: var(--green); color: var(--green); }

/* ADHD step formatting */
.step-badge {
  display: none;
  background: var(--gold); color: var(--black);
  border-radius: 4px; font-size: .7rem; font-weight: 800;
  padding: .1rem .4rem; margin-right: .4rem;
}
.adhd-break {
  display: none;
  background: rgba(74,222,128,0.1); border: 1px solid var(--green);
  border-radius: 10px; padding: .75rem 1rem;
  color: var(--green); font-size: .85rem; text-align: center;
  margin: .5rem 0;
}
body.mode-adhd .adhd-break { display: block; }

/* Dyscalculia calculator */
#calc-overlay {
  display: none;
  position: fixed; bottom: 80px; right: 20px;
  background: var(--bg2); border: 1px solid var(--gold);
  border-radius: 20px; padding: 1.5rem;
  z-index: 999; width: 300px;
  box-shadow: var(--shadow), var(--glow);
}
#calc-overlay.show { display: block; }
.calc-title { font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; justify-content: space-between; }
.calc-visual {
  background: var(--bg3); border-radius: 10px; padding: 1rem;
  font-size: 1.2rem; text-align: center; min-height: 60px;
  margin-bottom: 1rem; border: 1px solid var(--border);
  font-family: var(--font-mono);
}
.calc-btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: .4rem; }
.calc-key {
  padding: .75rem; border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg3); color: var(--white);
  font-size: .9rem; font-weight: 600; cursor: pointer;
  transition: all .2s; font-family: var(--font-mono);
}
.calc-key:hover { background: var(--bg4); border-color: var(--gold); }
.calc-key.op { color: var(--gold); }
.calc-key.eq { background: var(--gold); color: var(--black); border-color: var(--gold); }
.calc-key.eq:hover { background: var(--gold-light); }
.calc-number-line {
  margin-top: 1rem; overflow-x: auto;
  padding: .5rem 0;
}
.number-line {
  display: flex; align-items: center;
  gap: 0; white-space: nowrap;
}
.nl-num {
  width: 36px; height: 36px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  border: 2px solid var(--border); font-size: .75rem;
  flex-shrink: 0; transition: all .3s;
  font-family: var(--font-mono);
}
.nl-num.highlight { background: var(--gold); color: var(--black); border-color: var(--gold); transform: scale(1.2); }
.nl-line { width: 20px; height: 2px; background: var(--border); flex-shrink: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTIONS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.questions-layout { max-width: 800px; margin: 0 auto; }
.form-card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 2rem;
  margin-bottom: 2rem;
}
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.gen-output {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 2rem;
  display: none;
}
.gen-output.show { display: block; }
.question-block {
  padding: 1.5rem; background: var(--bg3);
  border-radius: 10px; margin-bottom: 1.25rem;
  border: 1px solid var(--border);
}
.question-num {
  font-size: .75rem; font-weight: 700; color: var(--gold);
  text-transform: uppercase; margin-bottom: .5rem;
}
.question-text { font-size: .95rem; line-height: 1.7; margin-bottom: 1rem; }
.marks-badge {
  display: inline-block; background: rgba(201,168,76,0.1);
  color: var(--gold); border-radius: 6px;
  font-size: .75rem; font-weight: 700; padding: .2rem .6rem;
}
.answer-space {
  min-height: 80px; background: var(--bg4);
  border: 1px dashed var(--border); border-radius: 8px;
  padding: 1rem; margin-top: .75rem; color: var(--muted);
  font-size: .85rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.heatmap {
  display: grid; grid-template-columns: repeat(7, 1fr);
  gap: 4px; margin-top: 1rem;
}
.heat-cell {
  aspect-ratio: 1; border-radius: 4px;
  background: var(--bg4); transition: all .2s; cursor: pointer;
  position: relative;
}
.heat-cell.l1 { background: rgba(201,168,76,0.2); }
.heat-cell.l2 { background: rgba(201,168,76,0.4); }
.heat-cell.l3 { background: rgba(201,168,76,0.7); }
.heat-cell.l4 { background: var(--gold); }
.heat-cell:hover::after {
  content: attr(data-tip);
  position: absolute; bottom: calc(100% + 6px); left: 50%;
  transform: translateX(-50%);
  background: var(--bg3); border: 1px solid var(--border);
  padding: .25rem .5rem; border-radius: 6px;
  font-size: .7rem; white-space: nowrap; z-index: 10;
}
.achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; }
.ach-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 12px; padding: 1rem; text-align: center;
  transition: all .2s;
}
.ach-card.earned { border-color: rgba(201,168,76,0.4); }
.ach-card.locked { opacity: .4; }
.ach-icon { font-size: 2rem; margin-bottom: .5rem; }
.ach-name { font-size: .75rem; font-weight: 700; }
.ach-desc { font-size: .65rem; color: var(--muted); margin-top: .2rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STRENGTHS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.strengths-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
.strength-item, .weakness-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: .875rem 1rem; background: var(--bg3);
  border-radius: 8px; margin-bottom: .5rem; border: 1px solid var(--border);
}
.strength-item { border-left: 3px solid var(--green); }
.weakness-item { border-left: 3px solid var(--red); }
.sw-topic { font-size: .875rem; font-weight: 600; }
.sw-pct { font-size: .875rem; font-weight: 800; }
.sw-pct.good { color: var(--green); }
.sw-pct.bad { color: var(--red); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ASSIGNMENTS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.assign-tabs { display: flex; gap: .5rem; margin-bottom: 2rem; }
.assign-tab {
  padding: .6rem 1.25rem; border-radius: 8px;
  border: 1px solid var(--border); background: transparent;
  color: var(--muted); font-weight: 600; cursor: pointer; transition: all .2s;
}
.assign-tab.active { background: var(--gold); color: var(--black); border-color: var(--gold); }
.assign-view { display: none; }
.assign-view.active { display: block; }
.assign-card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;
  transition: all .2s;
}
.assign-card:hover { border-color: rgba(201,168,76,0.3); }
.assign-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: .75rem; }
.assign-title { font-weight: 700; }
.assign-meta { font-size: .8rem; color: var(--muted); margin-bottom: 1rem; }
.status-badge {
  padding: .25rem .75rem; border-radius: 20px;
  font-size: .75rem; font-weight: 700;
}
.status-new { background: rgba(96,165,250,0.15); color: var(--blue); }
.status-due { background: rgba(251,146,60,0.15); color: var(--orange); }
.status-done { background: rgba(74,222,128,0.15); color: var(--green); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-section { margin-bottom: 2.5rem; }
.settings-section h3 { font-size: 1rem; font-weight: 700; margin-bottom: 1.25rem; padding-bottom: .75rem; border-bottom: 1px solid var(--border); }
.setting-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
}
.setting-info h4 { font-size: .9rem; font-weight: 600; }
.setting-info p { font-size: .8rem; color: var(--muted); margin-top: .2rem; }
.toggle {
  width: 48px; height: 26px; background: var(--bg4);
  border-radius: 13px; cursor: pointer; position: relative;
  transition: background .3s; border: 1px solid var(--border);
}
.toggle.on { background: var(--gold); border-color: var(--gold); }
.toggle::after {
  content: ''; position: absolute;
  width: 20px; height: 20px; background: white;
  border-radius: 50%; top: 2px; left: 2px;
  transition: transform .3s;
}
.toggle.on::after { transform: translateX(22px); }
.a11y-full-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 12px; padding: 1.25rem;
  margin-bottom: 1rem;
}
.a11y-full-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: .5rem; }
.a11y-full-header h4 { font-weight: 700; display: flex; align-items: center; gap: .5rem; }
.a11y-desc { font-size: .8rem; color: var(--muted); line-height: 1.5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast {
  position: fixed; bottom: 2rem; right: 2rem;
  background: var(--bg3); border: 1px solid var(--gold);
  border-radius: 12px; padding: 1rem 1.5rem;
  color: var(--white); font-size: .875rem; font-weight: 500;
  z-index: 9999; opacity: 0; transform: translateY(10px);
  transition: all .3s; pointer-events: none; max-width: 300px;
}
#toast.show { opacity: 1; transform: translateY(0); }

/* XP Popup */
#xp-popup {
  position: fixed; top: 80px; right: 2rem;
  background: var(--gold); color: var(--black);
  border-radius: 12px; padding: .75rem 1.25rem;
  font-weight: 800; font-size: .9rem;
  z-index: 9998; opacity: 0; transform: translateY(-10px);
  transition: all .3s; pointer-events: none;
}
#xp-popup.show { opacity: 1; transform: translateY(0); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRIVACY PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-privacy { padding-top: 64px; }
.privacy-body { max-width: 800px; margin: 0 auto; padding: 4rem 2rem; }
.privacy-body h1 { font-family: var(--font-head); font-size: 2.5rem; margin-bottom: 2rem; }
.privacy-body h2 { font-family: var(--font-head); font-size: 1.4rem; margin: 2rem 0 .75rem; color: var(--gold); }
.privacy-body p, .privacy-body li { color: var(--muted); line-height: 1.8; margin-bottom: .75rem; }

/* Cookie banner */
#cookie-banner {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--bg2); border-top: 1px solid var(--border);
  padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between;
  gap: 1rem; z-index: 999; flex-wrap: wrap;
}
.cookie-text { font-size: .85rem; color: var(--muted); flex: 1; min-width: 200px; }
.cookie-text a { color: var(--gold); text-decoration: none; }
.cookie-btns { display: flex; gap: .75rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes msgIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translate(-50%, 10px); } to { opacity: 1; transform: translate(-50%, 0); } }
@keyframes bounce { 0%,80%,100% { transform: scale(1); } 40% { transform: scale(1.4); } }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: .5; } }
@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

.loading {
  background: linear-gradient(90deg, var(--bg3) 25%, var(--bg4) 50%, var(--bg3) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px; color: transparent;
}

/* Subject colors */
.subj-math { color: #60A5FA; }
.subj-sci { color: #4ADE80; }
.subj-eng { color: #F472B6; }
.subj-hist { color: #FB923C; }
.subj-geo { color: #34D399; }
.subj-comp { color: #A78BFA; }
.subj-lang { color: #FBBF24; }
.subj-econ { color: #C9A84C; }

.fw700 { font-weight: 700; }
.text-gold { color: var(--gold); }
.text-muted { color: var(--muted); }
.mt1 { margin-top: 1rem; }
.mb1 { margin-bottom: 1rem; }
.flex { display: flex; }
.gap { gap: .75rem; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BACKGROUND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hero-bg">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAVIGATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="nav">
  <div class="nav-logo" onclick="nav('home')">Lumina <span>AI</span></div>
  <div class="nav-links" id="public-nav">
    <a onclick="nav('home')">Home</a>
    <a onclick="scrollTo('#features')">Features</a>
    <a onclick="scrollTo('#pricing')">Pricing</a>
  </div>
  <div class="nav-links" id="app-nav" style="display:none">
    <a onclick="showDash('home')" id="nl-home">Dashboard</a>
    <a onclick="showDash('tutor')" id="nl-tutor">AI Tutor</a>
    <a onclick="showDash('questions')" id="nl-questions">Questions</a>
    <a onclick="showDash('progress')" id="nl-progress">Progress</a>
    <a onclick="showDash('strengths')" id="nl-strengths">Strengths</a>
    <a onclick="showDash('assignments')" id="nl-assign">Assignments</a>
    <a onclick="showDash('settings')" id="nl-settings">Settings</a>
  </div>
  <div class="nav-right">
    <div class="a11y-bar" id="a11y-bar" style="display:none">
      <button class="a11y-btn" id="btn-adhd" onclick="toggleMode('adhd')">ADHD</button>
      <button class="a11y-btn" id="btn-dyslexia" onclick="toggleMode('dyslexia')">Dyslexia</button>
      <button class="a11y-btn" id="btn-dyscalculia" onclick="toggleMode('dyscalculia')">Dyscalculia</button>
    </div>
    <div id="xp-badge"><i class="fas fa-star"></i><span id="xp-display">0 XP</span></div>
    <div id="auth-buttons">
      <button class="btn btn-outline" onclick="nav('auth')">Log In</button>
      <button class="btn btn-gold" onclick="nav('auth')">Sign Up</button>
    </div>
    <div id="user-menu" style="display:none">
      <button class="btn btn-outline" onclick="logout()">Log Out</button>
    </div>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-home" class="page active">

  <!-- Hero -->
  <section class="hero">
    <div class="hero-badge"><i class="fas fa-sparkles"></i> UK GCSE & A-Level Learning Platform</div>
    <h1>The <em>Smartest Way</em><br>to Prepare for Your Exams</h1>
    <p>AI-powered tutoring, personalised question papers, teacher assignments, and real-time progress tracking â€” built for every learner, including ADHD, dyslexia, and other learning differences.</p>
    <div class="hero-actions">
      <button class="btn-hero-primary" onclick="nav('auth')">Start Learning Free â†’</button>
      <button class="btn-hero-secondary" onclick="document.querySelector('.video-section').scrollIntoView({behavior:'smooth'})">â–¶ Watch How It Works</button>
    </div>
    <div class="trust-bar">
      <div class="trust-item"><i class="fas fa-credit-card"></i> No credit card required</div>
      <div class="trust-item"><i class="fas fa-graduation-cap"></i> All UK exam boards</div>
      <div class="trust-item"><i class="fas fa-brain"></i> ADHD & dyslexia friendly</div>
      <div class="trust-item"><i class="fas fa-shield-alt"></i> GDPR compliant</div>
    </div>
  </section>

  <!-- Video Section -->
  <section class="video-section">
    <div class="section-label">See it in action</div>
    <h2>Watch How Lumina AI Works</h2>
    <p>A 90-second walkthrough showing how students use the AI tutor, generate exam questions, and track their progress.</p>
    <div class="video-player">
      <div class="video-main" id="video-main" onclick="startVideo()">
        <div class="video-preview-content">
          <div class="video-play-btn"><i class="fas fa-play"></i></div>
          <h3>How Lumina AI Works</h3>
          <p>AI Tutor Â· Exam Questions Â· Progress Tracking Â· Accessibility</p>
        </div>
      </div>
      <div class="video-chapters">
        <button class="chapter-btn active" onclick="playChapter(0)">
          <span class="chapter-icon">ğŸ‘‹</span>Welcome<br><span class="chapter-time">0:00</span>
        </button>
        <button class="chapter-btn" onclick="playChapter(1)">
          <span class="chapter-icon">ğŸ¤–</span>AI Tutor<br><span class="chapter-time">0:22</span>
        </button>
        <button class="chapter-btn" onclick="playChapter(2)">
          <span class="chapter-icon">ğŸ“</span>Questions<br><span class="chapter-time">0:45</span>
        </button>
        <button class="chapter-btn" onclick="playChapter(3)">
          <span class="chapter-icon">ğŸ“Š</span>Progress<br><span class="chapter-time">1:05</span>
        </button>
        <button class="chapter-btn" onclick="playChapter(4)">
          <span class="chapter-icon">â™¿</span>Accessibility<br><span class="chapter-time">1:22</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features-section" id="features">
    <div class="section-label" style="display:block;text-align:center;margin-bottom:1rem">What's inside</div>
    <h2>Everything a student needs to succeed</h2>
    <p class="sub">From AI tutoring to exam prep â€” Lumina adapts to how YOU learn best.</p>
    <div class="features-grid">
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ¤–</div>
        <h3>AI Tutor (Powered by Claude Opus)</h3>
        <p>Ask anything. Get step-by-step explanations tailored to your level, learning style, and exam board. Remembers what you've covered.</p>
        <span class="feature-tag">9 Subjects</span>
      </div>
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ“</div>
        <h3>Exam Question Generator</h3>
        <p>Generate real exam-style questions for any topic, mark scheme, difficulty and exam board. Get instant AI feedback on your answers.</p>
        <span class="feature-tag">All Exam Boards</span>
      </div>
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ¯</div>
        <h3>Strengths & Weaknesses Analyser</h3>
        <p>Claude analyses your performance and tells you exactly what to focus on. Get a personalised revision priority list.</p>
        <span class="feature-tag">AI Analysis</span>
      </div>
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ“Š</div>
        <h3>Progress Tracking</h3>
        <p>See your improvement over time with beautiful charts, study streaks, achievement badges and topic mastery scores.</p>
        <span class="feature-tag">Real-time</span>
      </div>
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ§®</div>
        <h3>Dyscalculia Calculator & Visual Maths</h3>
        <p>A dedicated number-line calculator that shows how maths works visually â€” step by step, with colour-coded operations.</p>
        <span class="feature-tag">Accessibility</span>
      </div>
      <div class="feature-card" onclick="nav('auth')">
        <div class="feature-icon">ğŸ‘¨â€ğŸ«</div>
        <h3>Teacher Assignments</h3>
        <p>Teachers set AI-powered homework. Students get AI hints. Teachers see real-time submission tracking with auto-grading.</p>
        <span class="feature-tag">For Schools</span>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="stats-section">
    <div class="stats-grid">
      <div><div class="stat-num">12,000+</div><div class="stat-label">Students Learning</div></div>
      <div><div class="stat-num">98%</div><div class="stat-label">Satisfaction Rate</div></div>
      <div><div class="stat-num">1M+</div><div class="stat-label">Questions Generated</div></div>
      <div><div class="stat-num">+42%</div><div class="stat-label">Average Grade Boost</div></div>
    </div>
  </section>

  <!-- Subjects -->
  <section class="subjects-section">
    <h2>All the subjects you need</h2>
    <div class="subjects-grid">
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">â•</div><div class="s-name">Mathematics</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">âš¡</div><div class="s-name">Physics</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ§ª</div><div class="s-name">Chemistry</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ§¬</div><div class="s-name">Biology</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ“–</div><div class="s-name">English Lit</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ›ï¸</div><div class="s-name">History</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ’»</div><div class="s-name">Computer Sci</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ’°</div><div class="s-name">Economics</div><div class="s-level">A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ‡«ğŸ‡·</div><div class="s-name">French</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸŒ</div><div class="s-name">Geography</div><div class="s-level">GCSE / A-Level</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ¨</div><div class="s-name">Art & Design</div><div class="s-level">GCSE</div></div>
      <div class="subject-pill" onclick="nav('auth')"><div class="s-icon">ğŸ“</div><div class="s-name">Further Maths</div><div class="s-level">A-Level</div></div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="pricing-section" id="pricing">
    <h2>Simple, transparent pricing</h2>
    <p class="pricing-sub">No hidden fees. Cancel any time. Start with a 7-day free trial.</p>
    <div class="pricing-grid">
      <div class="price-card">
        <div class="price-name">Student Plan</div>
        <div class="price-amount">Â£60<span>/month</span></div>
        <div class="price-desc">Perfect for individual GCSE & A-Level students</div>
        <ul class="price-features">
          <li><i class="fas fa-check"></i>Full AI Tutor (Claude Opus)</li>
          <li><i class="fas fa-check"></i>Unlimited practice questions</li>
          <li><i class="fas fa-check"></i>Personalised explanations</li>
          <li><i class="fas fa-check"></i>Exam preparation tools</li>
          <li><i class="fas fa-check"></i>Progress tracking</li>
          <li><i class="fas fa-check"></i>All accessibility features</li>
        </ul>
        <button class="btn-full" onclick="nav('auth')">Get Started</button>
      </div>
      <div class="price-card featured">
        <div class="price-name">Homeschool Plan</div>
        <div class="price-amount">Â£200<span>/month</span></div>
        <div class="price-desc">Complete AI tutoring system for homeschool families</div>
        <ul class="price-features">
          <li><i class="fas fa-check"></i>Everything in Student Plan</li>
          <li><i class="fas fa-check"></i>Full curriculum support</li>
          <li><i class="fas fa-check"></i>Teacher assignment tools</li>
          <li><i class="fas fa-check"></i>Parent progress dashboard</li>
          <li><i class="fas fa-check"></i>Multiple student profiles</li>
          <li><i class="fas fa-check"></i>Priority support</li>
        </ul>
        <button class="btn-full" onclick="nav('auth')">Get Started</button>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section">
    <h2>Ready to transform<br><em style="color:var(--gold);font-style:normal">how you learn?</em></h2>
    <p>Join thousands of UK students achieving better grades with AI-powered tutoring.</p>
    <button class="btn-hero-primary" onclick="nav('auth')">Start Your Free Trial â†’</button>
  </section>

  <!-- Footer -->
  <footer style="background:var(--bg2);border-top:1px solid var(--border);padding:2rem;text-align:center;">
    <div class="nav-logo" style="margin-bottom:.5rem">Lumina <span style="color:var(--gold)">AI</span></div>
    <p style="color:var(--muted);font-size:.8rem;margin-bottom:1rem">The smartest way to prepare for your exams</p>
    <div style="display:flex;gap:1.5rem;justify-content:center;font-size:.8rem;">
      <a onclick="nav('privacy')" style="color:var(--muted);cursor:pointer;text-decoration:none">Privacy Policy</a>
      <a style="color:var(--muted);cursor:pointer;text-decoration:none">Terms of Service</a>
      <a style="color:var(--muted);cursor:pointer;text-decoration:none">Contact</a>
    </div>
    <p style="color:var(--muted);font-size:.75rem;margin-top:1rem">Â© 2025 Lumina AI. All rights reserved.</p>
  </footer>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-auth" class="page">
  <div class="auth-box">
    <div class="auth-logo">Lumina <span>AI</span></div>
    <p class="auth-sub">Join thousands of UK students achieving better grades</p>

    <!-- Signup flow -->
    <div id="signup-flow">
      <div class="step-indicator">
        <div class="step-dot active" id="dot1"></div>
        <div class="step-dot" id="dot2"></div>
        <div class="step-dot" id="dot3"></div>
        <div class="step-dot" id="dot4"></div>
      </div>

      <!-- Step 1: Account -->
      <div class="auth-step active" id="step1">
        <h3 style="font-size:1.1rem;font-weight:700;margin-bottom:1.5rem">Create your account</h3>
        <div class="plan-options">
          <div class="plan-opt selected" id="plan-student" onclick="selectPlan('student')">
            <div class="plan-name">Student</div>
            <div class="plan-price">Â£60<span style="font-size:.75rem;font-weight:400">/mo</span></div>
            <div class="plan-tag">Individual</div>
          </div>
          <div class="plan-opt" id="plan-home" onclick="selectPlan('home')">
            <div class="plan-name">Homeschool</div>
            <div class="plan-price">Â£200<span style="font-size:.75rem;font-weight:400">/mo</span></div>
            <div class="plan-tag">Family</div>
          </div>
        </div>
        <div class="form-group"><label>Full Name</label><input type="text" id="reg-name" placeholder="Your full name"></div>
        <div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="you@email.com"></div>
        <div class="form-group"><label>Password</label><input type="password" id="reg-pass" placeholder="Min. 8 characters"></div>
        <button class="btn-full" onclick="nextStep(1)">Continue â†’</button>
      </div>

      <!-- Step 2: Profile -->
      <div class="auth-step" id="step2">
        <h3 style="font-size:1.1rem;font-weight:700;margin-bottom:1.5rem">Tell us about yourself</h3>
        <div class="form-group">
          <label>I am a...</label>
          <select id="reg-role">
            <option>Student</option>
            <option>Teacher</option>
            <option>Parent / Guardian</option>
          </select>
        </div>
        <div class="form-group">
          <label>Year Group</label>
          <select id="reg-year">
            <option>Year 9</option><option>Year 10</option><option selected>Year 11 (GCSE)</option>
            <option>Year 12 (AS)</option><option>Year 13 (A-Level)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Primary Subject</label>
          <select id="reg-subject">
            <option>Mathematics</option><option>Physics</option><option>Chemistry</option>
            <option>Biology</option><option>English Literature</option><option>History</option>
            <option>Computer Science</option><option>Economics</option><option>French</option>
          </select>
        </div>
        <div class="form-group">
          <label>Exam Board</label>
          <select id="reg-board">
            <option>AQA</option><option>Edexcel</option><option>OCR</option><option>WJEC</option>
          </select>
        </div>
        <button class="btn-full" onclick="nextStep(2)">Continue â†’</button>
        <button class="btn-back" onclick="prevStep(1)">â† Back</button>
      </div>

      <!-- Step 3: Learning needs -->
      <div class="auth-step" id="step3">
        <h3 style="font-size:1.1rem;font-weight:700;margin-bottom:.5rem">How do you learn best?</h3>
        <p style="color:var(--muted);font-size:.8rem;margin-bottom:1.5rem">Select any that apply â€” Lumina will adapt to you automatically</p>
        <div class="difficulty-grid">
          <div class="diff-card" id="diff-adhd" onclick="toggleDiff('adhd')">
            <div class="diff-icon">âš¡</div>
            <div class="diff-name">ADHD</div>
            <div class="diff-desc">Shorter tasks, focus breaks, clear structure</div>
          </div>
          <div class="diff-card" id="diff-dyslexia" onclick="toggleDiff('dyslexia')">
            <div class="diff-icon">ğŸ“–</div>
            <div class="diff-name">Dyslexia</div>
            <div class="diff-desc">Special fonts, spacing, audio read-aloud</div>
          </div>
          <div class="diff-card" id="diff-dyscalculia" onclick="toggleDiff('dyscalculia')">
            <div class="diff-icon">ğŸ§®</div>
            <div class="diff-name">Dyscalculia</div>
            <div class="diff-desc">Visual maths, number lines, step-by-step</div>
          </div>
          <div class="diff-card" id="diff-autism" onclick="toggleDiff('autism')">
            <div class="diff-icon">ğŸ§©</div>
            <div class="diff-name">Autism Spectrum</div>
            <div class="diff-desc">Predictable structure, literal explanations</div>
          </div>
          <div class="diff-card" id="diff-visual" onclick="toggleDiff('visual')">
            <div class="diff-icon">ğŸ‘ï¸</div>
            <div class="diff-name">Visual Impairment</div>
            <div class="diff-desc">High contrast, larger text</div>
          </div>
          <div class="diff-card" id="diff-none" onclick="toggleDiff('none')">
            <div class="diff-icon">âœ¨</div>
            <div class="diff-name">No Specific Needs</div>
            <div class="diff-desc">Standard experience</div>
          </div>
        </div>
        <button class="btn-full" style="margin-top:1.5rem" onclick="nextStep(3)">Continue â†’</button>
        <button class="btn-back" onclick="prevStep(2)">â† Back</button>
      </div>

      <!-- Step 4: GDPR -->
      <div class="auth-step" id="step4">
        <h3 style="font-size:1.1rem;font-weight:700;margin-bottom:1.5rem">Almost there! ğŸ‰</h3>
        <div style="background:var(--bg3);border-radius:12px;padding:1rem;margin-bottom:1.5rem;font-size:.85rem;color:var(--muted);line-height:1.6">
          <strong style="color:var(--white);display:block;margin-bottom:.5rem">Your learning profile is ready:</strong>
          <div id="profile-summary"></div>
        </div>
        <div class="gdpr-check">
          <input type="checkbox" id="gdpr-check">
          <label for="gdpr-check">I agree to the <a onclick="nav('privacy')">Privacy Policy</a> and <a href="#">Terms of Service</a>. I understand my data helps personalise my learning experience and can be deleted at any time.</label>
        </div>
        <button class="btn-full" onclick="createAccount()">ğŸš€ Start Learning Free</button>
        <button class="btn-back" onclick="prevStep(3)">â† Back</button>
      </div>
    </div>

    <!-- Login form -->
    <div class="login-form" id="login-form">
      <div class="auth-tabs">
        <button class="auth-tab" onclick="showSignup()">Sign Up</button>
        <button class="auth-tab active">Log In</button>
      </div>
      <div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="you@email.com"></div>
      <div class="form-group"><label>Password</label><input type="password" id="login-pass" placeholder="Your password"></div>
      <button class="btn-full" onclick="loginUser()">Log In â†’</button>
      <p style="text-align:center;margin-top:1rem;font-size:.8rem;color:var(--muted)">Don't have an account? <a onclick="showSignup()" style="color:var(--gold);cursor:pointer">Sign up free</a></p>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-dashboard" class="page">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-user">
      <div class="avatar" id="sb-avatar">S</div>
      <div class="sidebar-user-info">
        <div class="user-name" id="sb-name">Student</div>
        <div class="user-plan" id="sb-plan">Student Plan</div>
      </div>
    </div>
    <div class="sidebar-xp">
      <div class="xp-header">
        <span class="xp-level" id="xp-level-text">Level 1</span>
        <span style="color:var(--muted);font-size:.75rem" id="xp-progress-text">0 / 200 XP</span>
      </div>
      <div class="xp-bar"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
    </div>
    <div class="sidebar-nav">
      <div class="sidebar-section-label">Learning</div>
      <div class="sidebar-item active" id="si-home" onclick="showDash('home')"><i class="fas fa-house"></i>Dashboard</div>
      <div class="sidebar-item" id="si-tutor" onclick="showDash('tutor')"><i class="fas fa-robot"></i>AI Tutor</div>
      <div class="sidebar-item" id="si-questions" onclick="showDash('questions')"><i class="fas fa-file-lines"></i>Question Papers</div>
      <div class="sidebar-section-label">Progress</div>
      <div class="sidebar-item" id="si-progress" onclick="showDash('progress')"><i class="fas fa-chart-line"></i>Progress</div>
      <div class="sidebar-item" id="si-strengths" onclick="showDash('strengths')"><i class="fas fa-bullseye"></i>Strengths</div>
      <div class="sidebar-section-label">School</div>
      <div class="sidebar-item" id="si-assign" onclick="showDash('assignments')"><i class="fas fa-clipboard-list"></i>Assignments<span class="sidebar-badge">2</span></div>
      <div class="sidebar-section-label">Account</div>
      <div class="sidebar-item" id="si-settings" onclick="showDash('settings')"><i class="fas fa-gear"></i>Settings</div>
    </div>
  </div>

  <!-- Main content -->
  <div class="main-content">

    <!-- HOME SUBPAGE -->
    <div class="subpage active" id="sp-home">
      <div class="page-title" id="dash-greeting">Good morning! ğŸ‘‹</div>
      <p class="page-subtitle">Here's your learning overview</p>
      <div class="stats-row">
        <div class="stat-card"><div class="stat-card-label">Questions Answered</div><div class="stat-card-value" id="stat-q">1,247</div><div class="stat-card-change">â†‘ 12 today</div></div>
        <div class="stat-card"><div class="stat-card-label">Accuracy Rate</div><div class="stat-card-value" id="stat-acc">78%</div><div class="stat-card-change">â†‘ 3% this week</div></div>
        <div class="stat-card"><div class="stat-card-label">Study Streak</div><div class="stat-card-value">14 ğŸ”¥</div><div class="stat-card-change">days in a row</div></div>
        <div class="stat-card"><div class="stat-card-label">Topics Mastered</div><div class="stat-card-value">23</div><div class="stat-card-change">of 60 total</div></div>
      </div>
      <div class="dash-grid">
        <div>
          <!-- Quick chat -->
          <div class="card" style="margin-bottom:1.5rem">
            <div class="card-header">
              <span class="card-title">ğŸ¤– Quick Ask â€” AI Tutor</span>
              <button class="btn btn-gold" style="font-size:.75rem;padding:.4rem .9rem" onclick="showDash('tutor')">Open Tutor â†’</button>
            </div>
            <div class="chat-messages" id="dash-chat"></div>
            <div class="chat-input-row">
              <textarea class="chat-input" id="dash-input" placeholder="Ask anything..." onkeydown="dashKey(event)"></textarea>
              <button class="chat-send" onclick="dashSend()">Send âœ¦</button>
            </div>
          </div>
          <!-- Progress -->
          <div class="card">
            <div class="card-header"><span class="card-title">ğŸ“Š Subject Progress</span></div>
            <div class="card-body">
              <div class="progress-item"><div class="progress-header"><span>Mathematics</span><span>72%</span></div><div class="progress-bar"><div class="progress-fill" style="width:72%;background:var(--blue)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Physics</span><span>65%</span></div><div class="progress-bar"><div class="progress-fill" style="width:65%;background:var(--green)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Chemistry</span><span>58%</span></div><div class="progress-bar"><div class="progress-fill" style="width:58%;background:var(--purple)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Biology</span><span>81%</span></div><div class="progress-bar"><div class="progress-fill" style="width:81%;background:var(--pink)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>English Lit</span><span>70%</span></div><div class="progress-bar"><div class="progress-fill" style="width:70%;background:var(--orange)"></div></div></div>
            </div>
          </div>
        </div>
        <div>
          <!-- Recent activity -->
          <div class="card">
            <div class="card-header"><span class="card-title">âš¡ Recent Activity</span></div>
            <div class="card-body" style="padding:1rem 1.5rem">
              <div class="activity-item"><div class="activity-icon" style="background:rgba(96,165,250,0.15);color:var(--blue)">ğŸ“</div><div><div class="activity-text fw700">Completed 5 Maths questions</div><div style="font-size:.75rem;color:var(--muted)">Algebra â€” Quadratics</div></div><div class="activity-time">2m</div></div>
              <div class="activity-item"><div class="activity-icon" style="background:rgba(201,168,76,0.15);color:var(--gold)">ğŸ¤–</div><div><div class="activity-text fw700">AI Tutor session</div><div style="font-size:.75rem;color:var(--muted)">Physics â€” Forces</div></div><div class="activity-time">1h</div></div>
              <div class="activity-item"><div class="activity-icon" style="background:rgba(74,222,128,0.15);color:var(--green)">âœ…</div><div><div class="activity-text fw700">Assignment submitted</div><div style="font-size:.75rem;color:var(--muted)">Chemistry homework</div></div><div class="activity-time">3h</div></div>
              <div class="activity-item"><div class="activity-icon" style="background:rgba(167,139,250,0.15);color:var(--purple)">ğŸ†</div><div><div class="activity-text fw700">Achievement unlocked!</div><div style="font-size:.75rem;color:var(--muted)">7-day streak ğŸ”¥</div></div><div class="activity-time">1d</div></div>
            </div>
          </div>
          <!-- Quick actions -->
          <div class="card" style="margin-top:1.5rem">
            <div class="card-header"><span class="card-title">ğŸš€ Quick Actions</span></div>
            <div class="card-body" style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem">
              <button class="btn btn-outline" style="border-radius:10px;padding:.875rem" onclick="showDash('tutor')">ğŸ¤– AI Tutor</button>
              <button class="btn btn-outline" style="border-radius:10px;padding:.875rem" onclick="showDash('questions')">ğŸ“ Generate Questions</button>
              <button class="btn btn-outline" style="border-radius:10px;padding:.875rem" onclick="showDash('progress')">ğŸ“Š Progress</button>
              <button class="btn btn-outline" style="border-radius:10px;padding:.875rem" onclick="showDash('strengths')">ğŸ¯ Strengths</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI TUTOR SUBPAGE -->
    <div class="subpage" id="sp-tutor" style="padding:0;margin:-2rem;height:calc(100vh - 64px)">
      <div class="tutor-layout">
        <div class="tutor-subjects">
          <h4>Subjects</h4>
          <button class="subj-btn active" id="tsub-math" onclick="setSubject('Mathematics','â•','math')">â• Mathematics</button>
          <button class="subj-btn" id="tsub-econ" onclick="setSubject('Economics','ğŸ’°','econ')">ğŸ’° Economics</button>
          <button class="subj-btn" id="tsub-phys" onclick="setSubject('Physics','âš¡','sci')">âš¡ Physics</button>
          <button class="subj-btn" id="tsub-chem" onclick="setSubject('Chemistry','ğŸ§ª','sci')">ğŸ§ª Chemistry</button>
          <button class="subj-btn" id="tsub-bio" onclick="setSubject('Biology','ğŸ§¬','sci')">ğŸ§¬ Biology</button>
          <button class="subj-btn" id="tsub-eng" onclick="setSubject('English Literature','ğŸ“–','eng')">ğŸ“– English Lit</button>
          <button class="subj-btn" id="tsub-hist" onclick="setSubject('History','ğŸ›ï¸','hist')">ğŸ›ï¸ History</button>
          <button class="subj-btn" id="tsub-comp" onclick="setSubject('Computer Science','ğŸ’»','comp')">ğŸ’» Computer Sci</button>
          <button class="subj-btn" id="tsub-fr" onclick="setSubject('French','ğŸ‡«ğŸ‡·','lang')">ğŸ‡«ğŸ‡· French</button>
        </div>
        <div class="tutor-chat">
          <div class="tutor-header">
            <div>
              <h3 id="tutor-subject-title">Mathematics Tutor</h3>
              <p>Ask me anything â€” I'll explain step by step</p>
            </div>
            <div style="display:flex;gap:.5rem">
              <button class="tts-btn" id="tts-toggle" onclick="toggleTTS()" title="Read aloud (Dyslexia support)">ğŸ”Š</button>
              <button class="btn btn-outline" style="font-size:.75rem" onclick="clearTutor()">Clear Chat</button>
            </div>
          </div>
          <div class="quick-actions">
            <button class="quick-btn" onclick="tutorQuick('Explain a key concept for me')">ğŸ’¡ Explain concept</button>
            <button class="quick-btn" onclick="tutorQuick('Give me a practice question')">ğŸ“ Practice question</button>
            <button class="quick-btn" onclick="tutorQuick('Give me exam technique tips')">ğŸ¯ Exam technique</button>
            <button class="quick-btn" onclick="tutorQuick('What are the most common exam topics?')">ğŸ“‹ Common topics</button>
            <button class="quick-btn" onclick="tutorQuick('Explain this simply as if I am 10 years old')">ğŸ§’ Simplify</button>
          </div>
          <div class="tutor-messages" id="tutor-messages"></div>
          <div class="tutor-input-area">
            <div class="tutor-input-row">
              <textarea class="tutor-input" id="tutor-input" placeholder="Ask your tutor anything..." onkeydown="tutorKey(event)" rows="1"></textarea>
              <button class="tts-btn" id="speak-btn" onclick="speakInput()" title="Speak your question">ğŸ¤</button>
              <button class="tutor-send" onclick="tutorSend()">Send âœ¦</button>
            </div>
            <p style="font-size:.75rem;color:var(--muted);margin-top:.5rem;text-align:center">Powered by Claude Opus â€” your personal AI tutor</p>
          </div>
        </div>
      </div>
    </div>

    <!-- QUESTIONS SUBPAGE -->
    <div class="subpage" id="sp-questions">
      <div class="page-title">ğŸ“ Question Paper Generator</div>
      <p class="page-subtitle">Generate exam-style questions tailored to your level and board</p>
      <div class="questions-layout">
        <div class="form-card">
          <div class="form-row">
            <div class="form-group"><label>Subject</label>
              <select id="q-subject">
                <option>Mathematics</option><option>Physics</option><option>Chemistry</option>
                <option>Biology</option><option>English Literature</option><option>History</option>
                <option>Computer Science</option><option>Economics</option><option>French</option>
              </select>
            </div>
            <div class="form-group"><label>Exam Board</label>
              <select id="q-board"><option>AQA</option><option>Edexcel</option><option>OCR</option><option>WJEC</option></select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Level</label>
              <select id="q-level"><option>Foundation GCSE</option><option>Higher GCSE</option><option>AS Level</option><option>A-Level</option></select>
            </div>
            <div class="form-group"><label>Number of Questions</label>
              <select id="q-num"><option>3</option><option selected>5</option><option>8</option><option>10</option></select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Question Type</label>
              <select id="q-type"><option>Mixed</option><option>Multiple Choice</option><option>Short Answer</option><option>Extended Writing</option><option>Calculation</option></select>
            </div>
            <div class="form-group"><label>Target Grade</label>
              <select id="q-grade"><option>Grade 4-5</option><option>Grade 6-7</option><option selected>Grade 7-8</option><option>Grade 8-9</option></select>
            </div>
          </div>
          <div class="form-group"><label>Specific Topics (optional)</label>
            <input type="text" id="q-topics" placeholder="e.g. Quadratics, Pythagoras, Trigonometry">
          </div>
          <button class="btn btn-gold" style="width:100%;padding:1rem;font-size:1rem" onclick="generateQuestions()">âœ¦ Generate with Claude Opus</button>
        </div>
        <div class="gen-output" id="q-output">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem">
            <div><div class="page-title" style="font-size:1.4rem" id="q-output-title">Practice Paper</div>
            <p class="text-muted" id="q-output-sub">5 questions</p></div>
            <div style="display:flex;gap:.75rem">
              <button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Print</button>
              <button class="btn btn-gold" onclick="generateQuestions()">â†» Regenerate</button>
            </div>
          </div>
          <div id="q-questions"></div>
        </div>
      </div>
    </div>

    <!-- PROGRESS SUBPAGE -->
    <div class="subpage" id="sp-progress">
      <div class="page-title">ğŸ“Š Your Progress</div>
      <p class="page-subtitle">Track your improvement over time</p>
      <div class="stats-row">
        <div class="stat-card"><div class="stat-card-label">Total Questions</div><div class="stat-card-value">1,247</div><div class="stat-card-change">â†‘ 12 today</div></div>
        <div class="stat-card"><div class="stat-card-label">Accuracy</div><div class="stat-card-value">78%</div><div class="stat-card-change">â†‘ 3% this week</div></div>
        <div class="stat-card"><div class="stat-card-label">Study Streak</div><div class="stat-card-value">14 ğŸ”¥</div></div>
        <div class="stat-card"><div class="stat-card-label">Topics Mastered</div><div class="stat-card-value">23</div></div>
      </div>
      <div class="dash-grid">
        <div>
          <div class="card">
            <div class="card-header"><span class="card-title">Subject Performance</span></div>
            <div class="card-body">
              <div class="progress-item"><div class="progress-header"><span>Mathematics</span><span class="fw700" style="color:var(--blue)">72%</span></div><div class="progress-bar"><div class="progress-fill" style="width:72%;background:var(--blue)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Biology</span><span class="fw700" style="color:var(--green)">81%</span></div><div class="progress-bar"><div class="progress-fill" style="width:81%;background:var(--green)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Physics</span><span class="fw700" style="color:var(--purple)">65%</span></div><div class="progress-bar"><div class="progress-fill" style="width:65%;background:var(--purple)"></div></div></div>
              <div class="progress-item"><div class="progress-header"><span>Chemistry</span><span class="fw700" style="color:var(--orange)">58%</span></div><div class="progress-bar"><div class="progress-fill" style="width:58%;background:var(--orange)"></div></div></div>
            </div>
          </div>
          <!-- Heatmap -->
          <div class="card" style="margin-top:1.5rem">
            <div class="card-header"><span class="card-title">ğŸ“… Study Activity (Last 12 Weeks)</span></div>
            <div class="card-body">
              <div class="heatmap" id="heatmap"></div>
              <div style="display:flex;align-items:center;gap:.5rem;margin-top:1rem;font-size:.75rem;color:var(--muted)">
                Less <div style="width:14px;height:14px;background:var(--bg4);border-radius:2px"></div>
                <div style="width:14px;height:14px;background:rgba(201,168,76,0.2);border-radius:2px"></div>
                <div style="width:14px;height:14px;background:rgba(201,168,76,0.5);border-radius:2px"></div>
                <div style="width:14px;height:14px;background:var(--gold);border-radius:2px"></div> More
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="card">
            <div class="card-header"><span class="card-title">ğŸ† Achievements</span></div>
            <div class="card-body">
              <div class="achievements-grid">
                <div class="ach-card earned"><div class="ach-icon">ğŸ”¥</div><div class="ach-name">7-Day Streak</div><div class="ach-desc">Study 7 days in a row</div></div>
                <div class="ach-card earned"><div class="ach-icon">ğŸ’¯</div><div class="ach-name">Perfect Score</div><div class="ach-desc">100% on a paper</div></div>
                <div class="ach-card earned"><div class="ach-icon">ğŸš€</div><div class="ach-name">Fast Learner</div><div class="ach-desc">Complete 100 questions</div></div>
                <div class="ach-card locked"><div class="ach-icon">â­</div><div class="ach-name">Star Student</div><div class="ach-desc">30-day streak</div></div>
                <div class="ach-card locked"><div class="ach-icon">ğŸ“</div><div class="ach-name">Graduate</div><div class="ach-desc">Master all topics</div></div>
                <div class="ach-card locked"><div class="ach-icon">ğŸ†</div><div class="ach-name">Top of Class</div><div class="ach-desc">Score 95%+ average</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- STRENGTHS SUBPAGE -->
    <div class="subpage" id="sp-strengths">
      <div class="page-title">ğŸ¯ Strengths & Weaknesses</div>
      <p class="page-subtitle">Know exactly what to focus on</p>
      <div style="margin-bottom:1.5rem">
        <button class="btn btn-gold" onclick="analyseStrengths()">âœ¦ Run AI Analysis with Claude Opus</button>
      </div>
      <div class="strengths-grid">
        <div class="card">
          <div class="card-header" style="border-left:3px solid var(--green)"><span class="card-title">ğŸ’ª Your Strengths</span></div>
          <div class="card-body" id="strengths-list">
            <div class="strength-item"><span class="sw-topic">Biology â€” Cell Structure</span><span class="sw-pct good">91%</span></div>
            <div class="strength-item"><span class="sw-topic">Maths â€” Algebra</span><span class="sw-pct good">88%</span></div>
            <div class="strength-item"><span class="sw-topic">English â€” Analysis</span><span class="sw-pct good">85%</span></div>
            <div class="strength-item"><span class="sw-topic">History â€” WW2</span><span class="sw-pct good">82%</span></div>
            <div class="strength-item"><span class="sw-topic">Physics â€” Waves</span><span class="sw-pct good">79%</span></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" style="border-left:3px solid var(--red)"><span class="card-title">âš ï¸ Focus Areas</span></div>
          <div class="card-body" id="weaknesses-list">
            <div class="weakness-item"><span class="sw-topic">Maths â€” Trigonometry</span><span class="sw-pct bad">38%</span></div>
            <div class="weakness-item"><span class="sw-topic">Chemistry â€” Organic</span><span class="sw-pct bad">42%</span></div>
            <div class="weakness-item"><span class="sw-topic">Physics â€” Electricity</span><span class="sw-pct bad">45%</span></div>
            <div class="weakness-item"><span class="sw-topic">Maths â€” Statistics</span><span class="sw-pct bad">51%</span></div>
            <div class="weakness-item"><span class="sw-topic">Biology â€” Genetics</span><span class="sw-pct bad">55%</span></div>
          </div>
        </div>
      </div>
      <div class="card" id="ai-recs" style="margin-top:1.5rem;display:none">
        <div class="card-header"><span class="card-title">ğŸ¤– AI Recommendations</span></div>
        <div class="card-body" id="ai-recs-body"></div>
      </div>
    </div>

    <!-- ASSIGNMENTS SUBPAGE -->
    <div class="subpage" id="sp-assignments">
      <div class="page-title">ğŸ“‹ Assignments</div>
      <p class="page-subtitle">Teacher-set homework and AI-assisted completion</p>
      <div class="assign-tabs">
        <button class="assign-tab active" id="at-student" onclick="switchAssign('student')">ğŸ‘¨â€ğŸ“ Student View</button>
        <button class="assign-tab" id="at-teacher" onclick="switchAssign('teacher')">ğŸ‘¨â€ğŸ« Teacher View</button>
      </div>
      <div class="assign-view active" id="av-student">
        <div class="assign-card">
          <div class="assign-header">
            <div class="assign-title">Algebra Practice â€” Quadratics</div>
            <span class="status-badge status-due">Due Soon</span>
          </div>
          <div class="assign-meta">ğŸ“š Mathematics Â· AQA Higher Â· Due: Tomorrow Â· 20 marks</div>
          <p style="font-size:.875rem;color:var(--muted);margin-bottom:1rem">Solve the following quadratic equations and show all working. Use the quadratic formula where necessary.</p>
          <div style="display:flex;gap:.75rem">
            <button class="btn btn-gold" onclick="openAssignment(1)">Start Assignment</button>
            <button class="btn btn-outline" onclick="getHint(1)">ğŸ’¡ Get AI Hint</button>
          </div>
        </div>
        <div class="assign-card">
          <div class="assign-header">
            <div class="assign-title">Forces & Newton's Laws Essay</div>
            <span class="status-badge status-new">New</span>
          </div>
          <div class="assign-meta">âš¡ Physics Â· Edexcel Â· Due: Friday Â· 15 marks</div>
          <p style="font-size:.875rem;color:var(--muted);margin-bottom:1rem">Write an extended answer explaining Newton's three laws of motion with real-world examples.</p>
          <div style="display:flex;gap:.75rem">
            <button class="btn btn-gold" onclick="openAssignment(2)">Start Assignment</button>
            <button class="btn btn-outline" onclick="getHint(2)">ğŸ’¡ Get AI Hint</button>
          </div>
        </div>
      </div>
      <div class="assign-view" id="av-teacher">
        <div class="form-card">
          <h3 style="font-weight:700;margin-bottom:1.5rem">Create New Assignment</h3>
          <div class="form-row">
            <div class="form-group"><label>Title</label><input type="text" id="asgn-title" placeholder="Assignment title"></div>
            <div class="form-group"><label>Subject</label><select id="asgn-subject"><option>Mathematics</option><option>Physics</option><option>Chemistry</option><option>Biology</option><option>English Literature</option><option>History</option></select></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Year Group</label><select id="asgn-year"><option>Year 10</option><option>Year 11</option><option>Year 12</option><option>Year 13</option></select></div>
            <div class="form-group"><label>Due Date</label><input type="date" id="asgn-due"></div>
          </div>
          <div class="form-group"><label>Instructions</label><textarea style="width:100%;padding:.875rem;background:var(--bg3);border:1px solid var(--border);border-radius:10px;color:var(--white);font-family:var(--font-body);min-height:80px;resize:vertical" id="asgn-instructions" placeholder="What should students do?"></textarea></div>
          <div style="display:flex;gap:.75rem">
            <button class="btn btn-gold" style="padding:.875rem 1.5rem" onclick="createAssignment()">âœ¦ Generate with Claude Opus</button>
            <button class="btn btn-outline" style="padding:.875rem 1.5rem" onclick="saveAssignment()">ğŸ’¾ Save & Assign</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SETTINGS SUBPAGE -->
    <div class="subpage" id="sp-settings">
      <div class="page-title">âš™ï¸ Settings</div>
      <p class="page-subtitle">Manage your account and learning preferences</p>
      <div class="settings-section">
        <h3>ğŸ¨ Accessibility Settings</h3>
        <p style="font-size:.85rem;color:var(--muted);margin-bottom:1.25rem">Each setting works independently â€” enable any combination that helps you learn best.</p>
        <div class="a11y-full-card">
          <div class="a11y-full-header">
            <h4>âš¡ ADHD Mode</h4>
            <div class="toggle" id="tog-adhd" onclick="toggleMode('adhd')"></div>
          </div>
          <p class="a11y-desc">Breaks content into numbered steps. Adds focus timers. Highlights key information. Shows break reminders every 25 minutes.</p>
        </div>
        <div class="a11y-full-card">
          <div class="a11y-full-header">
            <h4>ğŸ“– Dyslexia Mode</h4>
            <div class="toggle" id="tog-dyslexia" onclick="toggleMode('dyslexia')"></div>
          </div>
          <p class="a11y-desc">Switches to Lexend font with wider letter spacing and increased line height. Adds audio read-aloud button to all content.</p>
        </div>
        <div class="a11y-full-card">
          <div class="a11y-full-header">
            <h4>ğŸ§® Dyscalculia Mode</h4>
            <div class="toggle" id="tog-dyscalculia" onclick="toggleMode('dyscalculia')"></div>
          </div>
          <p class="a11y-desc">Opens a visual calculator with number line, colour-coded operations, and step-by-step breakdowns. All maths shown visually.</p>
        </div>
      </div>
      <div class="settings-section">
        <h3>ğŸ”” Notifications</h3>
        <div class="setting-row"><div class="setting-info"><h4>Study Reminders</h4><p>Get notified when it's time to study</p></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
        <div class="setting-row"><div class="setting-info"><h4>Assignment Due Dates</h4><p>Reminders 24h before deadlines</p></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
        <div class="setting-row"><div class="setting-info"><h4>Achievement Unlocked</h4><p>Celebrate your milestones</p></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
      </div>
      <div class="settings-section">
        <h3>ğŸ” Privacy & Data</h3>
        <div class="setting-row"><div class="setting-info"><h4>Download My Data</h4><p>Export all your learning data (GDPR)</p></div><button class="btn btn-outline" style="font-size:.8rem;padding:.5rem 1rem">Download</button></div>
        <div class="setting-row"><div class="setting-info"><h4>Delete Account</h4><p>Permanently delete your account and all data</p></div><button class="btn" style="background:rgba(251,113,133,0.1);color:var(--red);border:1px solid rgba(251,113,133,0.3);font-size:.8rem;padding:.5rem 1rem;border-radius:8px;cursor:pointer">Delete</button></div>
      </div>
    </div>

  </div><!-- end main-content -->
</div><!-- end page-dashboard -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRIVACY PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-privacy" class="page">
  <div class="privacy-body">
    <h1>Privacy Policy</h1>
    <p>Last updated: January 2025</p>
    <h2>1. Data We Collect</h2>
    <p>We collect your name, email, learning profile (including any learning difficulties you disclose), and learning activity data including questions answered, tutor conversations, and progress metrics.</p>
    <h2>2. How We Use Your Data</h2>
    <p>Your data is used exclusively to personalise your learning experience. Learning difficulty information is used to adapt the AI tutor, font settings, question formatting, and accessibility features.</p>
    <h2>3. AI Conversations</h2>
    <p>Your conversations with the AI tutor are processed via the Anthropic API. These conversations are used to provide responses and are not stored permanently beyond your active session.</p>
    <h2>4. Your Rights (GDPR)</h2>
    <p>You have the right to: access your data, correct inaccurate data, delete your data, export your data, and withdraw consent at any time. Contact us at privacy@luminaai.co.uk.</p>
    <h2>5. Data for Minors</h2>
    <p>For users under 13, we require parental consent. We collect minimal data and do not use it for any purpose beyond providing the educational service.</p>
    <h2>6. Cookies</h2>
    <p>We use essential cookies for authentication and optional analytics cookies (which you can decline). We do not use advertising cookies.</p>
    <p><button class="btn btn-gold" onclick="nav('home')">â† Back to Home</button></p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DYSCALCULIA CALCULATOR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="calc-overlay">
  <div class="calc-title">
    ğŸ§® Visual Calculator
    <button onclick="document.getElementById('calc-overlay').classList.remove('show')" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.2rem">âœ•</button>
  </div>
  <div class="calc-visual" id="calc-display">0</div>
  <div class="calc-btn-grid">
    <button class="calc-key" onclick="calcInput('7')">7</button>
    <button class="calc-key" onclick="calcInput('8')">8</button>
    <button class="calc-key" onclick="calcInput('9')">9</button>
    <button class="calc-key op" onclick="calcInput('Ã·')">Ã·</button>
    <button class="calc-key" onclick="calcInput('4')">4</button>
    <button class="calc-key" onclick="calcInput('5')">5</button>
    <button class="calc-key" onclick="calcInput('6')">6</button>
    <button class="calc-key op" onclick="calcInput('Ã—')">Ã—</button>
    <button class="calc-key" onclick="calcInput('1')">1</button>
    <button class="calc-key" onclick="calcInput('2')">2</button>
    <button class="calc-key" onclick="calcInput('3')">3</button>
    <button class="calc-key op" onclick="calcInput('âˆ’')">âˆ’</button>
    <button class="calc-key" onclick="calcInput('0')">0</button>
    <button class="calc-key" onclick="calcInput('.')">.</button>
    <button class="calc-key eq" onclick="calcEquals()">=</button>
    <button class="calc-key op" onclick="calcInput('+')">+</button>
    <button class="calc-key op" style="grid-column:span 2" onclick="calcClear()">Clear</button>
    <button class="calc-key op" style="grid-column:span 2" onclick="calcDelete()">âŒ« Delete</button>
  </div>
  <div class="calc-number-line" id="calc-number-line">
    <div class="number-line" id="nl"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST & XP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast"></div>
<div id="xp-popup">+50 XP â­</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COOKIE BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="cookie-banner">
  <p class="cookie-text">We use cookies to improve your experience and comply with GDPR. See our <a onclick="nav('privacy')">Privacy Policy</a>.</p>
  <div class="cookie-btns">
    <button class="btn btn-outline" style="font-size:.8rem" onclick="document.getElementById('cookie-banner').remove()">Reject</button>
    <button class="btn btn-gold" style="font-size:.8rem" onclick="document.getElementById('cookie-banner').remove()">Accept All</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const state = {
  user: null,
  xp: 0,
  level: 1,
  modes: { adhd: false, dyslexia: false, dyscalculia: false },
  subject: 'Mathematics',
  subjectColor: 'math',
  tutorHistory: [],
  dashHistory: [],
  selectedPlan: 'student',
  selectedDiffs: [],
  currentSubpage: 'home',
  ttsEnabled: false,
  calcValue: '',
  calcPrev: '',
  calcOp: ''
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nav(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const el = document.getElementById('page-' + page);
  if (el) el.classList.add('active');

  if (page === 'auth') {
    document.getElementById('public-nav').style.display = 'flex';
    document.getElementById('app-nav').style.display = 'none';
    document.getElementById('auth-buttons').style.display = 'flex';
    document.getElementById('user-menu').style.display = 'none';
    document.getElementById('a11y-bar').style.display = 'none';
    document.getElementById('xp-badge').style.display = 'none';
  }

  if (page === 'home' && !state.user) {
    document.getElementById('public-nav').style.display = 'flex';
    document.getElementById('app-nav').style.display = 'none';
    document.getElementById('auth-buttons').style.display = 'flex';
    document.getElementById('user-menu').style.display = 'none';
    document.getElementById('a11y-bar').style.display = 'none';
    document.getElementById('xp-badge').style.display = 'none';
  }
}

function scrollTo(sel) {
  const el = document.querySelector(sel);
  if (el) el.scrollIntoView({ behavior: 'smooth' });
}

function showDash(sub) {
  document.querySelectorAll('.subpage').forEach(s => s.classList.remove('active'));
  document.getElementById('sp-' + sub).classList.add('active');
  document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
  const si = document.getElementById('si-' + sub);
  if (si) si.classList.add('active');
  document.querySelectorAll('#app-nav a').forEach(a => a.classList.remove('active'));
  state.currentSubpage = sub;

  if (sub === 'progress') buildHeatmap();
  if (sub === 'home') {
    updateGreeting();
    if (state.dashHistory.length === 0) addDashMsg('bot', "Hello! I'm your Lumina AI tutor. What would you like to learn today? ğŸ“");
  }
  if (sub === 'tutor') {
    if (state.tutorHistory.length === 0) addTutorMsg('bot', `Hello! I'm your ${state.subject} tutor, powered by Claude Opus. I can explain concepts step-by-step, create practice questions, or help with exam technique.\n\nWhat would you like to work on today? âœ¦`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectPlan(p) {
  state.selectedPlan = p;
  document.getElementById('plan-student').classList.toggle('selected', p === 'student');
  document.getElementById('plan-home').classList.toggle('selected', p === 'home');
}

function toggleDiff(d) {
  if (d === 'none') {
    state.selectedDiffs = [];
    document.querySelectorAll('.diff-card').forEach(c => c.classList.remove('selected'));
    document.getElementById('diff-none').classList.add('selected');
    return;
  }
  document.getElementById('diff-none').classList.remove('selected');
  const el = document.getElementById('diff-' + d);
  if (state.selectedDiffs.includes(d)) {
    state.selectedDiffs = state.selectedDiffs.filter(x => x !== d);
    el.classList.remove('selected');
  } else {
    state.selectedDiffs.push(d);
    el.classList.add('selected');
  }
}

function nextStep(from) {
  if (from === 1) {
    const name = document.getElementById('reg-name').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const pass = document.getElementById('reg-pass').value;
    if (!name || !email || !pass) { showToast('Please fill in all fields'); return; }
    if (pass.length < 8) { showToast('Password must be at least 8 characters'); return; }
  }
  document.getElementById('step' + from).classList.remove('active');
  document.getElementById('step' + (from + 1)).classList.add('active');
  for (let i = 1; i <= 4; i++) {
    const dot = document.getElementById('dot' + i);
    dot.classList.toggle('active', i <= from + 1);
  }
  if (from === 3) {
    const diffs = state.selectedDiffs.length ? state.selectedDiffs.join(', ') : 'No specific needs';
    document.getElementById('profile-summary').innerHTML = `
      <strong>Plan:</strong> ${state.selectedPlan === 'student' ? 'Student (Â£60/mo)' : 'Homeschool (Â£200/mo)'}<br>
      <strong>Year:</strong> ${document.getElementById('reg-year').value}<br>
      <strong>Subject:</strong> ${document.getElementById('reg-subject').value}<br>
      <strong>Learning needs:</strong> ${diffs}
    `;
  }
}

function prevStep(to) {
  document.querySelectorAll('.auth-step').forEach(s => s.classList.remove('active'));
  document.getElementById('step' + to).classList.add('active');
  for (let i = 1; i <= 4; i++) {
    document.getElementById('dot' + i).classList.toggle('active', i <= to);
  }
}

function createAccount() {
  if (!document.getElementById('gdpr-check').checked) {
    showToast('Please accept the privacy policy to continue'); return;
  }
  const name = document.getElementById('reg-name').value;
  const email = document.getElementById('reg-email').value;
  state.user = {
    name, email,
    plan: state.selectedPlan,
    year: document.getElementById('reg-year').value,
    subject: document.getElementById('reg-subject').value,
    board: document.getElementById('reg-board').value,
    diffs: state.selectedDiffs
  };
  try { localStorage.setItem('lumina_user', JSON.stringify(state.user)); } catch(e) {}
  applyLearningProfile();
  enterDashboard();
  addXP(100, 'ğŸ‰ Welcome bonus!');
}

function loginUser() {
  const email = document.getElementById('login-email').value;
  const pass = document.getElementById('login-pass').value;
  if (!email || !pass) { showToast('Please enter your email and password'); return; }
  // In a real app this would verify with a backend
  // For demo, restore from localStorage or create demo user
  try {
    const saved = localStorage.getItem('lumina_user');
    if (saved) { state.user = JSON.parse(saved); }
    else {
      state.user = { name: email.split('@')[0], email, plan: 'student', diffs: [] };
    }
  } catch(e) {
    state.user = { name: 'Student', email, plan: 'student', diffs: [] };
  }
  applyLearningProfile();
  enterDashboard();
}

function logout() {
  state.user = null;
  state.tutorHistory = [];
  state.dashHistory = [];
  try { localStorage.removeItem('lumina_user'); } catch(e) {}
  document.getElementById('app-nav').style.display = 'none';
  document.getElementById('public-nav').style.display = 'flex';
  document.getElementById('auth-buttons').style.display = 'flex';
  document.getElementById('user-menu').style.display = 'none';
  document.getElementById('a11y-bar').style.display = 'none';
  document.getElementById('xp-badge').style.display = 'none';
  nav('home');
  showToast('Logged out successfully');
}

function enterDashboard() {
  // Update sidebar
  const u = state.user;
  document.getElementById('sb-name').textContent = u.name;
  document.getElementById('sb-plan').textContent = u.plan === 'student' ? 'Student Plan' : 'Homeschool Plan';
  document.getElementById('sb-avatar').textContent = u.name.charAt(0).toUpperCase();
  document.getElementById('dash-greeting').textContent = `${getGreeting()}, ${u.name.split(' ')[0]}! ğŸ‘‹`;

  // Swap nav
  document.getElementById('public-nav').style.display = 'none';
  document.getElementById('app-nav').style.display = 'flex';
  document.getElementById('auth-buttons').style.display = 'none';
  document.getElementById('user-menu').style.display = 'flex';
  document.getElementById('a11y-bar').style.display = 'flex';
  document.getElementById('xp-badge').style.display = 'flex';

  nav('dashboard');
  showDash('home');
}

function showSignup() {
  document.getElementById('signup-flow').style.display = 'block';
  document.getElementById('login-form').classList.remove('active');
}

function showLogin() {
  document.getElementById('signup-flow').style.display = 'none';
  document.getElementById('login-form').classList.add('active');
}

// Check auth tabs
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.auth-tab').forEach((tab, i) => {
    tab.addEventListener('click', () => {
      if (i === 0) showSignup();
      else showLogin();
    });
  });
  // Check for saved session
  try {
    const saved = localStorage.getItem('lumina_user');
    if (saved) {
      state.user = JSON.parse(saved);
      applyLearningProfile();
    }
  } catch(e) {}
  buildNumberLine(0);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCESSIBILITY MODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyLearningProfile() {
  if (!state.user || !state.user.diffs) return;
  const diffs = state.user.diffs;
  if (diffs.includes('adhd')) setMode('adhd', true);
  if (diffs.includes('dyslexia')) setMode('dyslexia', true);
  if (diffs.includes('dyscalculia')) setMode('dyscalculia', true);
}

function setMode(mode, on) {
  state.modes[mode] = on;
  document.body.classList.toggle('mode-' + mode, on);
  const btn = document.getElementById('btn-' + mode);
  if (btn) btn.classList.toggle('on', on);
  const tog = document.getElementById('tog-' + mode);
  if (tog) tog.classList.toggle('on', on);
  if (mode === 'dyscalculia') {
    document.getElementById('calc-overlay').classList.toggle('show', on);
  }
}

function toggleMode(mode) {
  setMode(mode, !state.modes[mode]);
  if (mode === 'adhd' && state.modes[mode]) showToast('âš¡ ADHD Mode ON â€” content will be broken into steps');
  if (mode === 'dyslexia' && state.modes[mode]) showToast('ğŸ“– Dyslexia Mode ON â€” Lexend font enabled');
  if (mode === 'dyscalculia' && state.modes[mode]) showToast('ğŸ§® Dyscalculia Mode ON â€” visual calculator opened');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcInput(val) {
  const ops = ['+', 'âˆ’', 'Ã—', 'Ã·'];
  if (ops.includes(val)) {
    if (state.calcValue) {
      state.calcPrev = state.calcValue;
      state.calcOp = val;
      state.calcValue = '';
    }
  } else {
    if (state.calcValue === '0' && val !== '.') state.calcValue = val;
    else state.calcValue += val;
  }
  updateCalcDisplay();
}

function calcEquals() {
  if (!state.calcPrev || !state.calcOp || !state.calcValue) return;
  const a = parseFloat(state.calcPrev), b = parseFloat(state.calcValue);
  let result;
  if (state.calcOp === '+') result = a + b;
  else if (state.calcOp === 'âˆ’') result = a - b;
  else if (state.calcOp === 'Ã—') result = a * b;
  else if (state.calcOp === 'Ã·') result = b !== 0 ? a / b : 'Error';
  const disp = document.getElementById('calc-display');
  disp.innerHTML = `<span style="color:var(--muted);font-size:.9rem">${state.calcPrev} ${state.calcOp} ${state.calcValue} =</span><br><span style="font-size:1.5rem;color:var(--gold)">${result}</span>`;
  buildNumberLine(result);
  state.calcValue = String(result);
  state.calcPrev = '';
  state.calcOp = '';
}

function calcClear() {
  state.calcValue = '';
  state.calcPrev = '';
  state.calcOp = '';
  document.getElementById('calc-display').textContent = '0';
  buildNumberLine(0);
}

function calcDelete() {
  state.calcValue = state.calcValue.slice(0, -1);
  updateCalcDisplay();
}

function updateCalcDisplay() {
  const disp = document.getElementById('calc-display');
  let shown = '';
  if (state.calcPrev) shown += `${state.calcPrev} ${state.calcOp} `;
  shown += state.calcValue || '0';
  disp.textContent = shown;
  const num = parseFloat(state.calcValue || '0');
  if (!isNaN(num)) buildNumberLine(num);
}

function buildNumberLine(highlight) {
  const container = document.getElementById('nl');
  if (!container) return;
  const hl = Math.round(highlight);
  const start = Math.max(0, hl - 5);
  const end = start + 10;
  let html = '';
  for (let i = start; i <= end; i++) {
    html += `<div class="nl-num ${i === hl ? 'highlight' : ''}">${i}</div>`;
    if (i < end) html += '<div class="nl-line"></div>';
  }
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLAUDE API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function callClaude(messages, system) {
  const body = {
    model: 'claude-opus-4-6',
    max_tokens: 1500,
    messages
  };
  if (system) body.system = system;
  let r;
  try {
    r = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
  } catch (netErr) {
    throw new Error('Network error â€” check /api/chat is deployed: ' + netErr.message);
  }
  const text = await r.text();
  let data;
  try { data = JSON.parse(text); } catch (e) { throw new Error('Bad API response (' + r.status + '): ' + text.slice(0, 200)); }
  if (!r.ok) throw new Error('API error ' + r.status + ': ' + JSON.stringify(data));
  if (data.error) throw new Error('Anthropic error: ' + JSON.stringify(data.error));
  return data;
}

function getReply(data) {
  return data.content && data.content[0] ? data.content[0].text : '(no response)';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEARNING PROFILE SYSTEM PROMPT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getA11yInstructions() {
  const parts = [];
  if (state.modes.adhd) parts.push('ADHD MODE: Format all responses with clear numbered steps. Keep each step SHORT (max 2 sentences). Add "ğŸ¯ FOCUS:" before the most important point. After 4+ steps add "â¸ï¸ QUICK BREAK â€” Stand up, stretch for 30 seconds, then continue."');
  if (state.modes.dyslexia) parts.push('DYSLEXIA MODE: Use very short sentences. Avoid long words where possible. Use bullet points. Add a "ğŸ“¢ Summary in one sentence:" at the end of every response.');
  if (state.modes.dyscalculia) parts.push('DYSCALCULIA MODE: For ANY maths, always write it out in words first, then show the visual representation. Break every calculation into tiny steps. Use colours like [RED: subtract] [GREEN: add] [BLUE: multiply]. Show each step on its own line.');
  return parts.join('\n\n');
}

function getTutorSystem() {
  const user = state.user;
  const year = user?.year || 'Year 11';
  const board = user?.board || 'AQA';
  let sys = `You are an expert ${state.subject} tutor for UK students, specialising in ${board} ${year}. 
Your name is Lumina. You are encouraging, patient, and brilliant at explaining complex ideas simply.
Always tailor your explanations to the student's level. Use UK terminology and exam board conventions.
When giving examples, use real-world scenarios. If the student seems stuck, break it down further.
For maths and science, always show your working step by step.`;
  const a11y = getA11yInstructions();
  if (a11y) sys += '\n\n' + a11y;
  return sys;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUTOR CHAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSubject(name, icon, color) {
  state.subject = name;
  state.subjectColor = color;
  state.tutorHistory = [];
  document.querySelectorAll('.subj-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tutor-subject-title').textContent = name + ' Tutor';
  document.getElementById('tutor-messages').innerHTML = '';
  addTutorMsg('bot', `Subject switched to ${icon} ${name}! I'm ready to help. What would you like to explore? âœ¦`);
}

function addTutorMsg(role, text) {
  const el = document.createElement('div');
  el.className = 'msg ' + role;
  // Format ADHD steps
  if (state.modes.adhd && role === 'bot') {
    el.innerHTML = formatADHD(text);
  } else {
    el.textContent = text;
  }
  document.getElementById('tutor-messages').appendChild(el);
  document.getElementById('tutor-messages').scrollTop = 99999;
  if (role === 'bot' && state.ttsEnabled) speak(text);
}

function formatADHD(text) {
  // Add visual step breaks
  return text.replace(/\n/g, '<br>')
    .replace(/(\d+\.) /g, '<span class="step-badge" style="display:inline-block">$1</span> ');
}

async function tutorSend() {
  const input = document.getElementById('tutor-input');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  addTutorMsg('user', text);
  state.tutorHistory.push({ role: 'user', content: text });
  const typing = document.createElement('div');
  typing.className = 'msg bot typing';
  typing.innerHTML = '<span></span><span></span><span></span>';
  document.getElementById('tutor-messages').appendChild(typing);
  document.getElementById('tutor-messages').scrollTop = 99999;
  try {
    const data = await callClaude(state.tutorHistory, getTutorSystem());
    const reply = getReply(data);
    typing.remove();
    state.tutorHistory.push({ role: 'assistant', content: reply });
    addTutorMsg('bot', reply);
    addXP(10);
  } catch (e) {
    typing.remove();
    addTutorMsg('bot', 'âš ï¸ ' + e.message);
  }
}

function tutorKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); tutorSend(); }
}

function tutorQuick(prompt) {
  document.getElementById('tutor-input').value = prompt;
  tutorSend();
}

function clearTutor() {
  state.tutorHistory = [];
  document.getElementById('tutor-messages').innerHTML = '';
  addTutorMsg('bot', `Chat cleared! Ready to help with ${state.subject}. âœ¦`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD CHAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addDashMsg(role, text) {
  const el = document.createElement('div');
  el.className = 'msg ' + role;
  el.textContent = text;
  document.getElementById('dash-chat').appendChild(el);
  document.getElementById('dash-chat').scrollTop = 99999;
}

async function dashSend() {
  const input = document.getElementById('dash-input');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  addDashMsg('user', text);
  state.dashHistory.push({ role: 'user', content: text });
  const typing = document.createElement('div');
  typing.className = 'msg bot typing';
  typing.innerHTML = '<span></span><span></span><span></span>';
  document.getElementById('dash-chat').appendChild(typing);
  document.getElementById('dash-chat').scrollTop = 99999;
  const sys = 'You are Lumina, a helpful AI tutor. Answer questions concisely and helpfully for UK students. Keep answers short (2-3 paragraphs max) for the dashboard widget. ' + getA11yInstructions();
  try {
    const data = await callClaude(state.dashHistory, sys);
    const reply = getReply(data);
    typing.remove();
    state.dashHistory.push({ role: 'assistant', content: reply });
    addDashMsg('bot', reply);
    addXP(5);
  } catch (e) {
    typing.remove();
    addDashMsg('bot', 'âš ï¸ ' + e.message);
  }
}

function dashKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); dashSend(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION GENERATOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generateQuestions() {
  const sub = document.getElementById('q-subject').value;
  const board = document.getElementById('q-board').value;
  const level = document.getElementById('q-level').value;
  const num = document.getElementById('q-num').value;
  const type = document.getElementById('q-type').value;
  const grade = document.getElementById('q-grade').value;
  const topics = document.getElementById('q-topics').value;
  const output = document.getElementById('q-output');
  const qContainer = document.getElementById('q-questions');
  output.classList.add('show');
  document.getElementById('q-output-title').textContent = `${sub} Practice Paper`;
  document.getElementById('q-output-sub').textContent = `${num} questions Â· ${board} ${level} Â· ${grade}`;
  qContainer.innerHTML = '<div class="msg bot" style="max-width:100%">âœ¦ Generating your questions with Claude Opus...</div>';
  const a11y = getA11yInstructions();
  let sys = `You are an expert UK exam question writer specialising in ${board} ${level} ${sub}.
Generate exactly ${num} exam-style questions for ${grade} target.
Question types: ${type}. ${topics ? 'Focus on: ' + topics : 'Cover key topics.'}
Format STRICTLY as JSON array with this structure:
[{"question":"...","marks":3,"type":"short answer","hint":"..."}]
Each question must be exam-quality, use UK spelling, follow ${board} style.
ONLY return the JSON array, nothing else.${a11y ? '\n\nIMPORTANT accessibility notes: ' + a11y : ''}`;
  try {
    const data = await callClaude([{ role: 'user', content: `Generate ${num} ${sub} questions for ${board} ${level}, ${grade} target. ${topics ? 'Topics: ' + topics : ''}` }], sys);
    const reply = getReply(data);
    let questions;
    try {
      const clean = reply.replace(/```json|```/g, '').trim();
      questions = JSON.parse(clean);
    } catch (e) {
      qContainer.innerHTML = '<div class="msg bot" style="max-width:100%">âš ï¸ Could not parse questions. Raw response:<br>' + reply + '</div>';
      return;
    }
    qContainer.innerHTML = '';
    questions.forEach((q, i) => {
      qContainer.innerHTML += `
        <div class="question-block">
          <div class="question-num">Question ${i + 1} <span class="marks-badge">${q.marks || 3} marks</span></div>
          <div class="question-text">${q.question}</div>
          ${q.hint ? `<div style="font-size:.8rem;color:var(--gold);margin-bottom:.5rem">ğŸ’¡ Hint: ${q.hint}</div>` : ''}
          <div class="answer-space" contenteditable="true" spellcheck="true" style="outline:none">Click here to write your answer...</div>
        </div>`;
    });
    addXP(20);
    showToast('âœ¦ Questions generated!');
  } catch (e) {
    qContainer.innerHTML = `<div class="msg bot" style="max-width:100%">âš ï¸ Error: ${e.message}</div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STRENGTHS ANALYSER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function analyseStrengths() {
  const recs = document.getElementById('ai-recs');
  const body = document.getElementById('ai-recs-body');
  recs.style.display = 'block';
  body.innerHTML = '<div class="msg bot" style="max-width:100%">â³ Claude Opus is analysing your performance...</div>';
  const sys = `You are an expert educational analyst. Given a student's strengths and weaknesses, provide specific, actionable recommendations.
Format response as HTML with: <div class="weakness-item"><span class="sw-topic">Action</span><span class="sw-pct bad">Priority</span></div>
Provide 5 specific study recommendations. Use Priority: HIGH, MEDIUM, or LOW.
${getA11yInstructions()}`;
  try {
    const data = await callClaude([{ role: 'user', content: 'My strongest topics: Biology Cell Structure (91%), Maths Algebra (88%), English Analysis (85%). My weakest: Maths Trigonometry (38%), Chemistry Organic (42%), Physics Electricity (45%). Give me a personalised study plan.' }], sys);
    body.innerHTML = getReply(data);
    addXP(15);
  } catch (e) {
    body.innerHTML = `<p style="color:var(--red)">âš ï¸ ${e.message}</p>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ASSIGNMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchAssign(view) {
  document.querySelectorAll('.assign-view').forEach(v => v.classList.remove('active'));
  document.getElementById('av-' + view).classList.add('active');
  document.querySelectorAll('.assign-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('at-' + view).classList.add('active');
}

async function getHint(id) {
  const hints = {
    1: 'quadratic equations â€” try using the quadratic formula x = (-b Â± âˆš(bÂ²-4ac)) / 2a, or factorising first',
    2: 'Newton\'s three laws â€” think about inertia, F=ma, and equal/opposite reactions with real examples'
  };
  showToast('ğŸ’¡ Asking Claude for a hint...');
  const sys = `You are a supportive tutor helping a student with their homework. Give a helpful HINT that guides them WITHOUT giving the answer away. Keep it to 2-3 sentences. ${getA11yInstructions()}`;
  try {
    const data = await callClaude([{ role: 'user', content: `Give me a hint for: ${hints[id]}. Don't give me the answer, just guide me.` }], sys);
    showToast('ğŸ’¡ ' + getReply(data).slice(0, 100) + '...');
  } catch (e) {
    showToast('âš ï¸ ' + e.message.slice(0, 80));
  }
}

async function createAssignment() {
  const title = document.getElementById('asgn-title').value;
  const subject = document.getElementById('asgn-subject').value;
  const year = document.getElementById('asgn-year').value;
  if (!title) { showToast('Please enter a title first'); return; }
  showToast('âœ¦ Generating assignment with Claude Opus...');
  const sys = `You are an experienced UK teacher creating a homework assignment. Write clear, engaging instructions appropriate for the level. Follow UK curriculum standards.`;
  try {
    const data = await callClaude([{ role: 'user', content: `Create a detailed homework assignment for ${year} ${subject} titled "${title}". Include learning objectives, instructions, mark scheme hints, and 3-5 specific tasks.` }], sys);
    document.getElementById('asgn-instructions').value = getReply(data).slice(0, 500);
    showToast('âœ¦ Assignment generated!');
  } catch (e) {
    showToast('âš ï¸ ' + e.message.slice(0, 80));
  }
}

function saveAssignment() { showToast('âœ… Assignment saved and sent to students!'); }
function openAssignment(id) { showToast('Opening assignment...'); showDash('tutor'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIDEO PLAYER (Interactive)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const videoChapters = [
  { title: 'Welcome to Lumina AI', desc: 'Learn how the platform transforms your studying', q: null },
  { title: 'AI Tutor', desc: 'Ask Claude Opus anything â€” step by step explanations', q: { text: 'What makes Lumina\'s AI tutor different from Google?', opts: ['It uses Claude Opus, the most advanced AI model', 'It has better images', 'It plays videos', 'It\'s cheaper'], correct: 0 } },
  { title: 'Question Generator', desc: 'Create real exam-style questions for any topic', q: { text: 'Which exam boards does Lumina support?', opts: ['Only AQA', 'AQA, Edexcel, OCR, and WJEC', 'Only Edexcel', 'No specific board'], correct: 1 } },
  { title: 'Progress Tracking', desc: 'See exactly how you\'re improving over time', q: null },
  { title: 'Accessibility Features', desc: 'ADHD, Dyslexia, and Dyscalculia support', q: { text: 'Which accessibility modes does Lumina offer?', opts: ['Only ADHD', 'Only dyslexia fonts', 'ADHD, Dyslexia AND Dyscalculia â€” separately', 'Colour blindness only'], correct: 2 } }
];
let currentChapter = 0;

function playChapter(i) {
  currentChapter = i;
  document.querySelectorAll('.chapter-btn').forEach((b, j) => b.classList.toggle('active', j === i));
  const chapter = videoChapters[i];
  const main = document.getElementById('video-main');
  const colors = ['#C9A84C', '#60A5FA', '#4ADE80', '#F472B6', '#A78BFA'];
  main.style.background = `radial-gradient(ellipse at center, ${colors[i]}22 0%, var(--bg3) 70%)`;
  main.querySelector('.video-preview-content h3').textContent = chapter.title;
  main.querySelector('.video-preview-content p').textContent = chapter.desc;
  const existing = main.querySelector('.video-question');
  if (existing) existing.remove();
  if (chapter.q) {
    setTimeout(() => showVideoQuestion(chapter.q), 1500);
  }
}

function startVideo() { playChapter(1); }

function showVideoQuestion(q) {
  const main = document.getElementById('video-main');
  const el = document.createElement('div');
  el.className = 'video-question show';
  el.innerHTML = `<h4>ğŸ“ Quick Check: ${q.text}</h4><div class="vq-options">${q.opts.map((o, i) => `<button class="vq-opt" onclick="answerVQ(this,${i},${q.correct})">${o}</button>`).join('')}</div>`;
  main.appendChild(el);
}

function answerVQ(btn, chosen, correct) {
  btn.parentElement.querySelectorAll('.vq-opt').forEach(b => b.onclick = null);
  if (chosen === correct) {
    btn.classList.add('correct');
    showToast('âœ… Correct! +5 XP');
    addXP(5);
  } else {
    btn.classList.add('wrong');
    btn.parentElement.children[correct].classList.add('correct');
    showToast('Not quite â€” the correct answer is highlighted');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEXT TO SPEECH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTTS() {
  state.ttsEnabled = !state.ttsEnabled;
  document.getElementById('tts-toggle').classList.toggle('active', state.ttsEnabled);
  showToast(state.ttsEnabled ? 'ğŸ”Š Read-aloud enabled' : 'ğŸ”‡ Read-aloud disabled');
}

function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const utt = new SpeechSynthesisUtterance(text.slice(0, 500));
  utt.rate = 0.9; utt.pitch = 1;
  window.speechSynthesis.speak(utt);
}

function speakInput() {
  if (!window.webkitSpeechRecognition && !window.SpeechRecognition) {
    showToast('Speech recognition not supported in this browser');
    return;
  }
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recog = new SR();
  recog.onresult = (e) => {
    document.getElementById('tutor-input').value = e.results[0][0].transcript;
  };
  recog.start();
  showToast('ğŸ¤ Listening...');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XP SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addXP(amount, msg) {
  state.xp += amount;
  const newLevel = Math.floor(state.xp / 200) + 1;
  if (newLevel > state.level) {
    state.level = newLevel;
    showToast(`ğŸ‰ Level Up! You're now Level ${newLevel}!`);
  }
  updateXPDisplay();
  const popup = document.getElementById('xp-popup');
  popup.textContent = (msg || `+${amount} XP â­`);
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 2000);
}

function updateXPDisplay() {
  const xpInLevel = state.xp % 200;
  document.getElementById('xp-display').textContent = state.xp + ' XP';
  document.getElementById('xp-level-text').textContent = 'Level ' + state.level;
  document.getElementById('xp-progress-text').textContent = xpInLevel + ' / 200 XP';
  document.getElementById('xp-fill').style.width = (xpInLevel / 200 * 100) + '%';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HEATMAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildHeatmap() {
  const el = document.getElementById('heatmap');
  const levels = ['', 'l1', 'l2', 'l3', 'l4'];
  let html = '';
  for (let i = 0; i < 84; i++) {
    const rand = Math.random();
    const lvl = rand < 0.3 ? 0 : rand < 0.5 ? 1 : rand < 0.7 ? 2 : rand < 0.9 ? 3 : 4;
    const date = new Date(); date.setDate(date.getDate() - (83 - i));
    const label = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
    html += `<div class="heat-cell ${levels[lvl]}" data-tip="${label}: ${lvl * 3} sessions"></div>`;
  }
  el.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(window._toastTimer);
  window._toastTimer = setTimeout(() => t.classList.remove('show'), 3500);
}

function getGreeting() {
  const h = new Date().getHours();
  return h < 12 ? 'Good morning' : h < 18 ? 'Good afternoon' : 'Good evening';
}

function updateGreeting() {
  const el = document.getElementById('dash-greeting');
  if (el && state.user) el.textContent = `${getGreeting()}, ${state.user.name.split(' ')[0]}! ğŸ‘‹`;
}

// Init welcome tutor message if on tutor subpage
function initTutor() {
  if (!document.getElementById('tutor-messages').children.length) {
    addTutorMsg('bot', `Hello! I'm your Mathematics tutor, powered by Claude Opus âœ¦\n\nI can explain any concept step by step, give you practice questions, help with exam technique, or simplify tricky topics.\n\nWhat would you like to work on today?`);
  }
}
</script>
</body>
</html>
